<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>《AI:梦境档案-涅槃肇始》游玩杂记</title>
      <link href="/2022/08/19/ai-the-somnium-files-2-memo/"/>
      <url>/2022/08/19/ai-the-somnium-files-2-memo/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="4cb2e7ed9318ad2d8164f5d11458b5e83a0ac4cff43221220b7b0cf8a227aec0">c9b0ea24a5f818fa73c110e17f28d0199dc82ffd7eff42a344e24a5db01a5c8cf939be456ae2d9e78116f266a9c7889de17f9f8a600a8bc480edc48e60dead728be0c9cbf5e7a7c6b8d417793971adc681bd8b4a4d6ce923446b384153e07283d82ae9b2e1555f5e1f83ee5a6e7e2b178f544c83480d8b215b8ed6d4ad22e4bee3b64fcd329fede060c6b12262c717fbefdd7ff44d60ed0b4d307cdf0c26a6cae76b830b6f0a4d06225c14c9f14fbe19ddd74b1ac33706c144e0f89ba9618848bf34c408c5a9e63b1b0d5321d4bc2d8152ef1ccfcd14a2249a00176fe2646049f7d796f158c3129e069af0e4dbdec3da3876af8053ef285bdcfe65006ea604f0ec03ff18668335765609ad1e30fe13ed54fb2a6136ed5de745996d337111cc02d5db5b6b70e1a28b2fbe8d2046bc600b0482ec7c9ecaa2212f51a9c7967bf216b1e6a70a1891a765bd263b360c4140a2f1eb68aa0e2e6e9831be9cd0d2cf25fc95ed374e11b38aef0a66972db4884c6f5807cc839a8dcaa587216a0521d53193f5a9a79793e1a0c981c672e45784141bdc1285c3f229d7cdc5cc44304e46447ce95bea3729f4dbf50793e4bf8dad1f69250a99010fa0f8fea1b25ae5f2343c3cd947546e5d7bedbb34af55de6befaffe33c4ad1e8333d5eef8515da384fde3dca102680bc6b83e7fdf5e8aa9ee3950a3fc3be45aca388153243f6e69f01fab4eb22aec8c9883662fadfd1eb3f6e10128d29ee6b2353aed1bb50e457229d4c955bc12c9db06b904f6906a9f1348d2b621af231b42959619f137d791868fb28ad77b7c67e5272592652cec767cbf906324c1829d9b152bdc2458105844d8cd39eb1b5c71aa87132421453bda33decb350c2d8a02977331a86f7bcf920c01120ed91b3e1eca8a8b2d42089426258ada26350554a310bbdde2a3c3cbdf8058b9e6eac9b06427339f4b672a684f915d5be1c870de2aee9af54beda5f37e0a0620660fb44a7c5dc58d6ffb75ca4c4c63dd89d816055f53d1d3d3aad1175a334cf5afac36d4e4fb0f6daadc85a37d4fc3332008665ef2d6cba756f2c9d28aa3abb96d2e1e9fb2b27e9de1612b9c63696a42664786c10eb694b301f48bd13385f0ba3258f00063e9d549b86e26bfe9795d509fc252ab4938bfae01130c05d270467cf0b2d9d1f4c8fb773552f54bbc7580fd598eb4c9de8a9a537af719bb16e24d640d22780a4a05c0a06c0f1432ab210912b91e7657e448c0395d260801044aa112f31f83b2346bc05c5ce52e5405c434bf96c99f631ff2dc36ef780d81d68d0cfb561f6dd9483878f4bb2e9358f892954c3a57740943a61759c985cf2d879c27af89cd3226e91ede0010ab5213d69df310aec07df54887b8fb117b0a7c89b5f8a3dd75204d7630eaa52ddf108304c76f0763d315ed7a81d6b24773208629d6c2180016f2045f982f794931e31d849eb5ce139672c48a454fd0a0b41c60a53cda6c0e75e287f2f459fe1786df8fb0467e17505c67e88956ff926540581b9f166e97b46bab63bf636cc3bb5cb81df9ac39772b3ad4678051d640dec09a7ca9e6d3c78d6e175621c7ba04edac5decc7f57978500229a27d2b7e5932ccb3f795d3db5c6655d0912963f08204360e7c2983635aaf030d95b7eaed65d4d275219ec60dce2e1e7aa5b5a8fb09ada2a69e1fc7dd8e165902dfc3ccc4d263a4b85378210686304ad1d398eee2344b726d959e1085bd6fc6cb50a1f59cc51e2ca0c5062896d2f9e1ff7db837afdca72a7774f45b5e6cc1e61441b1d6d34df765a108fd1284d75b49dae068711a93d03e5552d43abd18616fa748f6f747bc010f454103388a9bbeb985d873a018a2a1dc6bf40e6372fda13a4783869fd749b5dbe205779912f94949fc96a6919fcfebeb9755c54f5dd89539c74f984b8abd12e5869a55574ce45bddc5c1845de0aa40d4aed8c38b23fe6dc5c028066d5fedf5c02e268c04e515a79b25a9eac280dd4a249f83906430ba2253754658b16259f6f63bb88b7cc5d5f71eb240784c7fb5c7250d566b82fcd30c118b0d05442b1bef7a651f9647a2c3b16903d1f5aa8cf22a4f555852f20c5544d4474d894df48228bf19a457ccd4553e40941ff2e4097997256a5933e438f8e6c8e195ff2be33b1e8cd4bae42d51a2b34d3ad76e8dbc4e5a2ee731dedddb6faf3851c9b878fe7e0f683c0229171688ea5cfd1d8384dbfd57f65bdbec14a91fa72d140b08df993851c40f6f950a0cb548aa488919f352a8e998067112c9d946827f220c6a5d9391a6eef51bab259d93bb783c29ec12f8b8a5936cf063d1521e3e7e69b9eb2fbbb288f62ed938fadd308bdb58bcd63885bb729e50204d3767cd79cce6c8fc085fac29dc4ce69951a7a78f0c8f2da040997f910604cea0b3e4ae1e66785843b60e0ece3758e2905542e65e2af55ddb06302ba6106c130bf395a15acb4db3dc821c7d0c4ffcfe3989e63ad83772ce09c68b8e5f1773a3ca8f5a16e028d4fc2a89744d9d145994d67be7f6f77c9a23203b6c0d5886dfd41776ab467da27116419ac509846969e435ce89a720017fbf7a5d41784fa493ad7a1c25ab9db20ca9bd7d6e4ceba575a68f59974ccc309a08f528e2694781dfe131fec9bfa80134674b32644452b9e30ae4aad5b9e92e2c324b65fcd2a31008ccbda68c76306dd6ee8711dcc84ff0c20c12f53301bb7850fc227323e51890d3a53ceec49676e1f0dc05fa488a54dfbda90e432227c3a6c9f4ed386980063c1d90d86a759e53ddfcb0a4246045f82797ab290fd29b56320e587a26b70b1b581247404f2d323089e4159daa13c513ec378b8ea5956cc09628bf04e58188e256eaecec1fe61abbd8a2bc753dc2c38b1a9b67c0e2ea777230e47630a745307c4794f8ac9b43401279d8b98b9528fb0c2a61efacd2a41a103a04bdc80f2a000dbf6e9a8f754b7dfc09b376e018a618c62276120356e8776c4bc6a2352d3efc0ef34061838af845c5d9d05dbfcf44afb216601395457a00b38cd798cc0ccdb5969ffc554d902510bdbd90af7370a759f716580bfc43b7f6e693ac3d8ddae970f32a91a38e3f98a83d08ecbf9ebdd59e9ba9e41ca6f4f20b89a3870ead94444166ebb9a057df833632e3db9d9a8b8270156bddde893e8902b817dc3dcbbb0ced8f6d1d7314342ddf0b51da498fc7350fc5bbaa291adb267b3183de82a3dd678fc27059e1d52ced934259cda9abfe8f62aeabc1aa794a7589d14d83dca864534db79093065b14eafc6923bf7ad5bd96b551542b185d72c427aa8dd12231a5be643126f9f89205d7275cd86a885103b0813ea571b2c95294d0e7be223973d5d20ecc9df67e6604b2f1a809b86c88c23b59072eb0ad095022b830dba641c43d5fd9f86aefe0ad58427b852fba2c98e2c4419caa3bb4fce562a43493928b220022d4057d0158b361b1d21eda2bcbaf4625a1ccb2c456c86044a3ba6f19c56c3c99980655391912f286cea9c910e29d0205d4ff6859ba95ef572c58154463e94b6c39099741053e6293505c7d31e98a62dded61a5e0ffce515a1ed8bd6b22b1d64d06232415393dc9519dd31cc3752a84525e31b47afe8ee8d278e033108cc52f46d24d9eddde94855a0c2b77838e5b48aba4733ef1615e1ebe5d279292c44088c3f9ce19c265e370f6d00539d303a47655f1444e96d4090e830055678dcb9dfbfc3524f2923e651b9d22a0aa2b8301eac16cefa96efad3a9983b813bd0a548e0af24620ace15ff6eb8e800ad851bed2c680c2db434cec1f8583f8453114f6ff6fbfba87139fe5bcc200cbd984225599f4996387692cddeec236fa1ff26c07421b41e8aedb4b2b0dbc6b85783e211df731ed3bc26aba516cfd9b47c71a4dd51fbe951377b2d721c28398c44d857d18a434a0dcc25e75cf2be12a2e6533b7a225c036e93934040e917267a910c3f97afda115deb73adae8de03236cbc7740b6f5f51512cde3e75871b4fffd13ef7b19a0517df5b89ea6aabca54c213da314864b57d8582e718d3f5646743bc1092377677762206c9b5047e92988b1da7bf2a17f9c090fe04f2af9a295fa4353c660b9164ecab1bfab927445d4ee1c15bb677c7b3e84c695967381f3c485275efd534385d186d5e742de0155c830aec3d596762c4e832da94402cd8139695b84c676a4611db3138cafbcae118b9db2f424d83bb9072d8d99c998294c2e0d03eced4e6262a3694e235ee8d9a1104f7d2a0b921ac3e9ab65c12e8b2d6d0c321746636e922402a1d67935996fec0b9090ffc19aa1c58fa3ec7f166971bd8daaa36e0aa417108be582b0ae8273f6678046c0f3f23adebe2c58f9c2a693bb2ea399414e9bd121e6b895496973f5b11c6665679c906fca5e1acf38b0d305ea23345edeb3b8c1fbf882d3310a4c13faa588cd342835b330f1cae19098aaa30a6100f194f0d8067fe2a110927cc0382442bc0262338b09f01804538daddd724795bbb970b4b31b9c44b2ea9cb56b2d81452bf5c79f82c12d57e26b62f991109b6336fb4883e948d74b57eb50f0c1bf25993df6b0fa324d2953c457e8897ef961cece318fcc201a8d9f217402d4baa355cea734fd4ab4d5402a4096756accd3b158096b30702f8e2346f24400136601c336ce5842c560cebda5b1ab5a8f760ef79904d6b5896d5895d6ca7cad8fd67acc688597d57d23d4eaa950cb3c6f87e51e2e1d7fae70e53963b49949179e733244c58fa0ef896b3f342ec10d706a25fe5150538e858e05d825d2045855813c9a025cd9320c9d686d6d9b17afc36294e061d802052a9b4d93475ad9d32d9a2cd35dff5f548398b5da211b015f0b292961dfb000c2c38b19e4fe96d1f48cd038654786b442f304a5a630eadd1e6bc3812d4f0a44d7e69a8573242d86abe3a919bcbc6e25f6105f830f3a92f43b7c1d35b7d8a125e72a1ca1e67aaad969eaf984a54abd6b1a189a4bad676c820891bac6e75d14ee5df5f10d93b72c76ca45b21596ebe359d2916c77a71458bf5e165c692847581f5b862416a08ad0508cfe3d251c87d37c86518787ef22582a38acc36ca02bb1e5d5bed2069abb6d54bbe101d834c4b43d7883422bff9e2c130911e104a151396da3d97f413b8b3a566f7615d99fd7fde55703dd3170e7fee7ee011866397021f9da35cee33b1c07b9618051e3f9ceb5c6980d16dfbe4ef15dfb7245bf9d7d1899fe42dfb4f1925056b36536f4a1774f46c3a13459c97474a287b1255bfd71a4f32a94b07389bf167e68031055070a3494fccbb79e55903b21f27745ae888594425aa0442bdb53cc470afa1da5ebbeb7e4646eedbd634b9acfd290b518f0e98790fa3a1ccf369303c74e798e2a4ec922fe70277ff652b0ba1db0cdd7b460a9e5fe0ca01fc3a60421873d8aa96882a21dc3118a8b0b9c803e4ce2a18b32ec197ef82c9dc146345ef1fe72eb94cb19a9e8bc1f49178d807ae91502744ebf0c0a74c883752cbd793c85e0efe6813de7dcfc1cf9bcf0d4ef67c3e123a32df6e118d55d48f183a51f809521cbdea4907a00cacb6287c2b5f898d269041d8114127ac231e9b923fd4e16f3031d075229be9c2416ff28f9e58068056973e451021a6d66ea03d9bee79fbca04002e88660ff87f782cfad07c6f908ec3912f3d217bed9c2e0e73b2f446da7fcd40c7afeee9c3254374c4c6496f9b4c5c318ebfe985763dd36b66a5b86ac576b57e50d57686cd7a713db74e461dcec3e56398f02ea8ed533f3671dc3ed735af3ebeb37d41465c64d4891f13abc5a81ed75cec0a525f7d96693ab782fde6fec40a13cc0cbf652c56906b13e9c24b0b94aa087c99b8c54c37b4c3f0cb5fa1acbfef90602dee6edbb9669e093e3ead77ad249f57980dc603beb34cd8eff40f3c5cd0136d37d0f02f773ef0684fa7e60b262f304487067f21a4962207630c21e1ec43b88c53a67a3c3cbb2498010eb68db5e93d184e60d7284bb2209f9686c0df212f35f29b76c76153d8e76a98acbc9d1f35fbb923bdd97184ce721b6ee579439c4473e6eb287ee0ba51e0cd7a9b3b2303b59bbdefbb4ba1423e1ee68c59f47a7d45a59d0911049ae7aab96f42d4437f90f60fe0e41a3c066a7beed53b7c6d8f8b419fd982c8d4243a86e4261f2c541d0ce35661306864c8ee0b1e502e136d4d69d1cfe50a0cf6e6fded285a2702d60edf01978f04550af2d57438613c07a9f48bef81f59af810393dbc688fccb28035c12c40a4a0fc66dcab154e7ab72994526c8fb3fc3aa38787d8754ebf863c31911572ecddeb4dac122e5b55687d9c19d770bb54bad2a862f2b2de8ee052ccfa07fc1d6067bf3a684bec947d8be037552a2c34839a9b5ac92ac37b34bc20e7c4a1ccbb502114996f06ad8786eeac59a61885756cee53441d47d11d215f1c2abb07a38363ca8da353cef546f8c5eed0e4c352b8ebdd195d98068ca594cdb947851893d90bc3b6e497887042bf3585a1b896d116bc330180f08d97a24fb4bf453b18171c6b1141359d7b3ad17b6eb65e0dc812c8a732ffd5578f8bd1ed4cdc6d77deabd064ea7d17ced01bdbcb2eab15ff00f70d1da7464ce436526bdafb96dfaff307e3117bb74c19562e5b1600f787244890ad420f989abd573e7e17e756b47821c5ee2129e4b4957d1113f78d7c46b23359bbf522e627b4b125a56c6816018aa75f135f11f0f7ddb88d08a7a3e978aadb71d2e75cd695667f5a5418cc37eb5c6fe8bf2fdf8c5f3add6c097443175866f070e2f709a217e6e72dd8ad6e51c49a3243a7b4a8b083dd3f90c2c5d6f8a13e44a2a190f219463718c84adfbe598d48e3a0f1acdeb1f36d8a92e8daf57b3956f2fcb13e0e94837dfd6502f1b9622571a42b4b5090c07d82874e4d412b9d59d392795e249256cafd093667071b581c5684708fc42c699f858b4db7a43c97a97c6bf3cdf68fbc78b9b7fa10eb2652fc5e51cb3bf607c9ff3c14eaf260d61810d383de06ca054546db717b573846d65af06fda1bec260da3b9fb89092ebd4365f4f4d1c79f0b8a1952c8a982cbbf2c4a881f652de30f5e942b45b0e1ea0811042e6383bc735aa9e9c948e65b9cdac643909284ca77b13c48c2ddf81ba4d22fff420d8f16aa2e9e3010b6019b4062f4022e6f70912833caae842f8ac3399c1473f0ab9f3de57af1f5218e68aa07c17736ce6490f9dfbff173f6bd7958b0f2138a349bb011dbf2e5f13a449b0950ce9f0d5f0c3040ca16b478de83a14f937f96f5776f59d1cf25aadee4359ea39b0b171824f464e16fcbb297f3c0fac12b4700bd8127762c5d140e851d64ecabebcd0f7a0bbe5febc54c2b181cb12aa5754adebcb35e14012ab3f84ecbf12fd44d9536124cde2197ea76990b2dfe8865a50b8635a3159be6303a1e81f98b94be4a0eeb48610a0f2aa2dcfa7256764be607701bec06eea842ee9793845cd04b18698c779aec30ea79448fa1e9c793d6fb8303282ef024b48801bf0df5a8cf1c7c146b520e9d05cb618db4a835e2257fe4c8aad7b2f5d43ba1976fd371f83952de6316e3c7a94d3fedf5ddc45e51a19a7e9622615e019157015fa6ee63e048bbad2accc6f201d34185da5ce0c14c1e5a392e493c05c0c7ee48a897558f9312f7fc55324a2821e9ad920b6aa441b86e4f65b47f7989edf55d70a8a16d449158ba1ca8d3962dbda5be0be6f5e1010bae028922e6e50bfee3e8e9a7f897670f7f24ba9a169fbee5621465f3d0c7da647a6be9f8ab62c0e7cdfb7b0a3aa5cd55da1076e29de5dbac6f412a5d99b20156b8535886759c162f13f788a07de7e599f449e1f78f8870f7a9c27e571e440ce8b2ade48fe046e8957720b884e725efde2616f8f834dbb60a4a8250e7201736ca45cd61cca3826389b2e0a0162067da3840fe4a8e91cdc5ad80951db3fe57ee3b2a3e2c23ca7752c68a389bd54267ac0aea43e45fd6cda061e24a18df41ec5e1eaefe973a6f8c00c79e299f2ef1ef64a58259ea9448920681b4fef38367312a8ee0a43ce3309441cf0da4dc41c5b169f38f91c15072e678daea6fbb2724e32e2382c77ba32b13e153ec7cbb982694e93568e1a71b42473dcd6d129c89a38b81e5d394dfde150bed56477687d00bc2283137eb1ab3a740f507a6ac5447b64fccb449db5bc847707eda259ca503f732271dec2f943a3d7cc733f51bb739db8900053a3c7f3fe8aceaf4ed60bebb524454d9e2bf00e35d15e60e9d6f7dcece5362d67828be3c7fe6aadf3d84c5ed514352ec76f32d110f2f4c34ef7b3820595bcc125050aa1dcece801943f74053f53b5e6b6547ce68e3c055a18ac8e207276daa4c1cda8683881208581dad0038f02a1813fc36a650204090836eb30816a7e279fc89b9a8f1e0e304c35c51a87407b6ddb507905ab987231567fb5e0f15f41915431469cec5a297cc6b4807e15cf4bab40709c2a1f08f70870c2318574a1f7e9e5544de2b18f6d3cea441db42b61f98de9392a7dae7ee4a2924b478ea483ffeea7e2487aab95692fed63d020bf80bd2a46982e742fd4c162a24d85f91eb9fa2b04141fafaa867b4592545e9d84d419d47673346db43d50869cb7caddea1abdbd4bccccafebd1f3e61bf3b0928be05f2ab72914d88a790b54b5a7156bda3163aaacb18a3b24b3d09ac6a66fa99776df566053bb81074c5be52ba8aefa6cee72f7e42d8ba499bb84eea817b2c38bc06b54c84cd81d54c0b858da973f81732cbb061b3ec72d565e63daae2271a7dc3524fcdcf13a7cf774659ec9f17760aa7b4c4c8f9065abfcb69c35402cb4f271cf2003b7c574d43086f03663cb5ef18e97639c976651ce559d1f00ea67664d5f324765e19e06aaacb8ffce42effd5160b26e371e670f96b4a3f0b3537de5612fb5b36e096987b287daf63a94a95764b940fa4989dfc4765731d7497222bab0ffa37086dd8a89a1aab330c3be6f1a51619bc361b8438a065bed7cecc9e000abfdb2333e1ef80d4b111da48db2bbcbe23c697928c67c751a8f9a2d3f7b3919d1a489652c1f6482079a10ac96d6a948ed7bffb85b96ed035916e6301b6546672465adaa91f77e3e47070e92388f8cb7de71ce326374d8f78cbdf13d64504eaebc0f796ed72f7a2ae3e4592854a670f805a0495545ba74331cd77d566907a8b1a1a6c91742c55d8a81ad25832992ec303a842115486047447e4b4923021c1317b41fa7b580df7a8492da9b9499446bfac8f7310b2ccd322d352c84b54417eaad72ec96da8f2b59d39f92c8fbd957ed869f1bc2494316c0d3d432be09afae67ad76df664e886393f14d3e30a3f2e64a22c0b531cd2b2e853f59a15c400366be785c0561f517e1b811a8ffb9a40722df19165838ebbc9da374ddb996180de5f97cd872136f8d6989d991aefca3387b4b8fed6712f7db8f7a08bf5accb1ff7c8161e9528c4fcf2665d7a65a9f1d2a02aaf0353f7d1cc45603adfee6e35332455dca4c52cee3a453b60fc298f1cd94998e72b21b4a8e8d6776da5a38bc163059a1ab05a7083db34c2b373b467c963ed79e0f85fdd83eb35302badb93b5ce051a492a18b84473c6cd1550ca710a8ee18f801851ef990e2c26369dad6470ba3da85dcd380da5e8e5f8148e29e0c5e639f73e796365deeb24b466265ddbd55a5f70f03ada1583fb51b6f9a6089692a296c914abdc42eb8a8c1b9bf8f74fa52e54d860b5a0a3b29ff0dc6986480a32ec5a42f198237308590e56d00abfa1cb42277a76b2c68475509b26dfdbf92c3aa8dc2fd7099ee47f07cf9d071cd0744a50b72e9777941ccfc20f662dd8319d3a69c1cdd49e3b213f3e0853600df39f47771bb8a8c2f87ac01726d7f3c52fa87512513bb1a0fd59c1504b28b17f1d4ec91b3f5357619da248fda812770712e90bbe4b8fea2ebe44a70148b8ace26408e399afb719ccb68545ecf8cc44be94dd4cc21fd2f545b5330e59facbf5596c26c389ce3af26b08628881cfecd6870a2f5483b27cb165b4bf84a6162e60f017e2d13b5b6140a55c210de6b284e0ae7fe95d00233247eb399d96f651be5b7d6a555eee11aed840bd1006d8720674fc3369bca50f3fa67befcded15f22a52e7da106f140898927fa434cf092d5e4c9ef04b1f19345c921a379a07abdd2410a23d0c76a32615122914eb08a381101a82a55577ef87703e1965142df20e1302d2533a79ff5a0aed698a3610644f3532a972c29b39b6a5187f3d63cb51002e067f707a2007e64be1ff5b2b3d2738cfb7d25cf331bcc668a528d2e1a99e5b3fbb9054e8c35c9b3114ad398c352c6e851b54d2ec06308786d350b693763de82e3b2ab6ccf38b46f5f3449e0bae0a14a121bced54b211c76954de87b556927b98f5160b5a02ee8287520e80668f7b5cc436a8207ff48f22b278b3c93be3e29649f483fde6276d262faee4528602713c1669b18b2cbca0ea7a5a5255b2b17e94f885df77d87db33ccf47d8f21ff21f8ac406d8877f73a545a4f70eea2ae1a1e745cbe7a6628c1ba7311845bf3c30e91c43b88407ee0a9ebb24569e2b73d1495ef0f7a0d935b704166903d1ca1ea47ac1820ea1fa00710150faf1e283c9fdaaa1ed86efcfae9967bc965bfb3272e4859a7eb04415cc0370606e4ac5079cf8b06834ca6ba1373a537597427ceeefa8ec71e77f13d26d588ef5363dd39748fca206c19164caf56540770ae7f0e1a3067c2e200d5366fac1275bffa046ca509dcb390ecc9a83aeba60ee325b12647c92500a250a0a0b0cab699ce9e621a6cf062e0dd6fa3f70f262f7e91d5db76825cd590e17498d44890f44b951783f08214f501efb1111453f57809d6ab7f804328fe2987e560498e738e226f99add58a54839090445c10048821f6a6cb9ec8fdb119bd0fb4d1378e761fa8e2929a2f19c99da75d659f37b83b627349f98627e3b83e4494f33161560db0b31e6d4b0ef14a864a6ffeaebccddb7d95044dff7746c80654ee092d5fe2eb03645e708b208adde85697134772e2dbfe00560538c8b63e20f0bbe8ece741820450326c15467ab6cc064a4f62721a6df0d452f487f5e37209d20dfaeb843271bbf87a63a03c2f78cc12e0caa30debfd024480dce61ea7210869bc889590c27f72fbe0d4c48b268f22cde595b98bdbe9158d73e70ff7a7a8f1e88f05b82d0509aa7b7dc29937c18e588bc7002d49e5080c12e0704a5d96bff51a5ea3c7f4cebd3f12f46772dcb4616111c4848c884e72d5312b95fea66248ce5efce2e5f41dda989a25dbe4ee8abcf72073b4744caac2a096261105091b03ad22bc9f2f7b4323f3358d9764e3efc36e06d30c8fddbc86784de7d86909931bfe8e134014283272cb0b595d50ca041b4823fe6537a7784e25e08ce7b693bbe04bcfae7049fa4a8ff930649fc78caca9737611073be3bbe63134e7fa202888b3f27e96501556aea45497823f1a3ff477aa0206d705d2416edfba4f2c1e8807b3ac5703903d2c36b18e8b4a211cb5105d28cdf85ee6f90d87445d9df6d3fc7b61b19946dd17cd5cdc8e73d7432cc5ce0fce3c8e7486efb5f63d3e7b00c51ea7e8b1efc6f0bfb80071a40bec12866fcc0511368f74a3411763aed8399e9961f750948261077629d57d4f177db04a5820bf2880a1863674fcffcb62d02bd72db93b2e1f16d65e714682da26adfbba40487996365601479bb2eba87011f8ea88cda9405deb2da6956587e6b698648741344547ceb2713a08a1b9535ba0f1bba815597f94de070df7309e6fc734dddc2ad30fd6d3ba294e1287d374c5b692182c45ccf2f78e45186d4478fe6094c8f7bccd7b5deefa9ba45c2fb481de16d5ef3dc569b790e3c26a6c1c8bda0b82b1aaf8237b834304fce07f1df74d177a7edc7acbb8a0ca3db9f25b81f6c4026df5db246ec0f761a8bdaa782c2cef6660c40105e9631d2c1eded6893ec1f4272d041bd5d26245c5bdc45919eac26dff564ed0f07661d97c1a274f73018dd27c2e4cf926da4d97ac5fc62c053ba86eb25f08f06f9f502f92db58a439e2292e1d335d2a466b9c2b65ac5da6892988dce98660b9678ea1dda484cc0c1f1d31ace2796be20af53e3ad48d73feed6661bedc15b05629a65199819bb83b6ede6251e1c46f2dd5c94d883fbcf2560a2665dfda4a249d27fe7ba36693135e3334600fb7188d1bd798d4e144aec3d1b801a1d6755f5e92d43007132525ceb5e1901f3df454edb5e26e69019556d41108ba127b12bc582c6b46107783cd372bbd24b022b0a0d20aebc57e5c46971a49217e7bb5dbd73d108e2049fa2f945a7e8e55a3553c5b2ce4ac0e4b18519888e1951b0a80e5c0a7c58637c21f80acf9805f17cbf354c565ed0e4f6c191e280e76c5d7e835d04105cc42b24aa601b8e2d553bfd06510c68de42ab6aa00c6bccfaace21ef8f9941c22b056d393278e8f0c4994838a176af7b4b3012c1115789f2282eac7ae6cf9589d7df2166cd3abeb5f88c5ffc09705b2d43fc48e767f0680dbeaf209f285782992dc8b837382dd5ffafbc878742fbaa6657e99e686773270bbe716a2213f8a4bd3a1ea74e60201a8a6d19d810706049347a24cbce4cf62a0bf25b6dd16a6358aa8729a8e1806507adf8b9ed09db6652460341baeff0b6234610f60f30a1f9e2f43db3e0e1fca9fe0648036a0f70f31853be8374a88f926212ee712e42f889a1cea29a084058eb42632d55f59548574ec3d63922a6c4c805363b869ca3d3a275d75183247d49e383b185d440dd398049b19550af028e641342f0db42bed97ba8b56f61a3f89a9077435889ad3c5bbda65f4d62fc4aa9c53921997e29b640d971ec99ed16295eb46ec994d739d6ffbbf0bc083b48a9e39f3d72ef3de3f5ffcba301d3f78520fb6cb493ac296f5f89a894995037a4a6856026987164aa1eb45bc3540386e1d3a8918dfb4a1ac90761dac4d3d452d2045adfe0a23f8751e90d4acf2abbd039e72f2887afed7f6247acc44f6c8b3a8190eae48fb5c3baf411b29f7105f18a7aff2494dc2fc32855c26597f06c5fc8a6b76566a35f021486244f393d5a2ec45fa6a58ac1ea6d33a39f372746257391b503bdd67fa43e81e92317a77650e3b7731f4c85c44d62729d7d61aabb56a0527334f7890dcea82ad9c02f5dcbf2fbffc640b5cc3c303229a00f40050f15af252f2f67280e47fea4cb14b5f433029ff7e87483c959a54089b3f4cef33006bfe0df885bfed245f936e84f73d55c9505b65726f62cd165f02e573246566fa4e1c0832eea39ba59cec63b3df2ddf00be47ffc9cf3a766f2d0aab0f3661ab1454bd37fe1cb11c1d6ba256059202916071ffa42423ea5211db3f8eee6e4a6f314e902e5a9ec728bb1af68c6ae93429416c317988644bcff456da423f9bb1ed7326014153e458a9f0d3092c47036de7984deda59defa9758468539208fd315b4f0fb1a9e6be1fa60a7e4895ee5c25be75b00dbb185026279cb42042f1cbe2b0a25df61580b6251cc37691fb58bb166edcda8c9e62e0704b58681e343329124e8bc8294a561f86123f195ff9ef514b960a33344a4cbd27f9e0724ce05b349e6e786b9a8727fcf7018c63c20344c4afe3f0342344c3e2cf60838feb65e245de44759cf7cd67d37eafdd5206ea38c9afdee59441b3a1607b91bccd038c8be65c795df5fe5451f8a26d1de2b40717a283e4d34431fb70d9f17879384591efc8db723a3b006afad4f2e9608e706d849ea856e81d31019c3091eadea78592b8a3caf3c67cfa3f5cfd3287f05f309178d3a0dc54776abf2fec5138f0978c1599f1b240abead2f21a51001941df89864a3a6e0439b3664f9b97a7c5ad73a975ff7f2ed8ea5c528c32a72a097d38b0e00597d65ff4e9ac2b6c927410a352e9ee60c3c7f3d6a8f5efd48bd40cce7fbf02e7d871a9bd9a68a65a6a8d40edc2030ffbd60a1d275ee4e2a98d5489aabfe18b17120bb76bcc35bdfa9ebabfba7f63eebe5e78e0aac19854672a37d451dcce2fd137231c77ce0c3f79c439058a3212895a49654eae64f5b86a2c2e67b31e5cd6ec1503c42b5068c7168d794ab84eb5db745fee47d9b8352163f6ff50c5eaf70bcdd5c73b786c8284da78401246d09191dd68eaa4452612efa513cb10ccf80016d22fbb14faffb6b8c8345d1ec7340df649efceebd852b1bd9be5a0f285cc6a069da646128be97c6b984c0b0392755ff465835b1a59beee89465cb00de4ce01cf651409cebfb7b5bdd58dcf34abbbf60b7194c8ea5cd23f8c308b649bdb8f511e54da5a623be815ef6157d32f1de5cd54b88d67e744fb49ae99fa8e289c78837eb6749c23a4cf934ab275d7b93d03b7d622b5a4edc5a321160d6a453894dd19894ffe524678424ab192d37db10d7c0c7d38c9ccbf2f35be22659f9bf487d2fb8807bba2c029a947b3b353253b931ad171d2318152b8b41207feecc2076f3bcb9b68029edcb4cc44ed45be8f52f908936bd2856a2e141e924ea9a6971f642c433ab8a4ad3df6743d156724df7e18440d4f0b5af794d9456003b4dab9b8b2bdce9c0f4f8735722d798d0fdedef547e09eb20c5c551398623fcfaabdb96e5b97a726cc26a856bd80b3ab91a7cfe4789017c6a94f2ba850555661e6bfb124f85ce6da434f91275b0c646c08b81ba375deb820ef607dbf8cf72eb83b1f4e6944e0689b749f1b39e20748f7a868ebf165a662d260e0b4b317d59b8074ce57d9cafecf750c789781060204ad3b35dc4da67df7248d633cc2352fbac3a41c9bbf4832774e3ce05147fe2523d66fb4d036e91898b517e07213a2430542f5a381d62caf7ef973b1c2d5aec889e9805d2c1f3befb8f0b85234376eb227ac30e9a70765cc8a9332840913e9f8b53de634d65505f73094be51d4b04d92ee5e6c38be0e2fcd257c019d5ebfae9b6860886a05135675d35aeb92e38de5b42f40b5e6e490478de6ba691f4f5241e90fd98a3560ee8d52e15dc9eda75a190c0d0155c335b15bb9df34a528c7f8cc023eb700504db45cf91dd459d9b4b9c6c5839323c7a7c7fa8ae7528e9eb52d0117f839710b9ac0a5ed8b5505604820d396b7adbfc03e3e3212e53619103f613a33479d9bc6ad2ebe3c427b4855679b51c311d444ba3a6926c31fdd56ae284cb7a5616bbd08cab868bcb6de1165eed6128a32c4ccc04f16215b5d91c59ae6b10efdb78a4dd4370ede174740acbd7ba90fb073abe30b085d75f4ebc5296e2516514aa852d404217137ff0f5f3fb27ae2512f0af5a02adb9564abc2e3514a84a9662c9dbc55324fbfcaf4a179c90a715ea6aa354a585dfde4c28b28f48728a56022074ba8340f430516d8f6a3a87eebb5e12c025d0a4179ef3f74b1de444841482e97ac28d8a9af5f880159823188c17515bf077c425c9a7b2f52fad4148a80f0ae3a88334debf5a9ea7e67c8b7e139573e8eb5a9a35f811fa08a14ec143bafbf228e31f3f9b2cd037b4552ff7a0a71c35055ac0fcd0f59c1eeddf3547c9fc338d1ec7a3430e2dff0b6c9b368aede6876d4110ad857ccb46911898ebfb5b04ab26c8ff4913558db9541c2021bd24d5297aafad6aaf1f0bdc904245cbdbba9ef4f5a817d16753330ccd19427f3ac3d87e097b7d5daedd375a7d4fa6fb9262f9aebb2a7a6a65804f05c796416ddcc0d815f4e1771ce37c5bba2ad73116a90ca3ba47bff264e584379e71b89b893ba57fb1c3c895405aaab09c30c9b19ab354f9eeb9383b054d42956b83a89a34ed9d403dce009234ac42a686eb59a1fb8d876888f26e2bd91e8e604ac7828eff7f680edb7c5dd41f48841ac15bf31fdc99570e107a24aadadf1d9893e40330cf7587343c597944e7b9e50e5928c6e470cebc466e4217c726ca06713b6684a37a866ae404868c04c04a720328f3fccd0a5c78afd6bb43358c62d3d6fffb3bfae11769972121c5085eb0a2e848bdb4f5f25c0ffab176dd741639a92693400f6e8c0e8336e122e0f40be3fe188443202c0457774ecc74786b95b4ad3778da903f072a16438c15871f33952ad3a7c1ac6c99acf8f8fed2424cc7535f9f14b7ae61b65e6e434e62f410a1ad833fd300b2ff74c2a06d2e1f9867fa884b866132284a003c9bf1c2ceec68e6374ec0abf7cf1bd8a97ef3e480ad7d4bbac7a6b6671d3d03940f7c859aab2ad0c8c862bfed062a2eab934a391535b972c479570f4ad12829cef659c3f23379470318019f2baecad823c9b083bbcd631b5396a39a33d4f458af503c8e71a93a6b1a685f44721b09c5b39c34cae88c767e31f8095094e036ffdac092660f577977177352bb59af95f1cf03de9c795db3eb6aee6a44dec28ed3290a8803cdc47a7cbe2937f729e7dcd9c99673463c9a6e2ce88fdbf0ac8eee284c0bfc663cf76e10c6fd6cd3aa3267f8283e32e9fc7ca432a228afb6fad2294c0fff66e5742628376c9a0aa2f22c594db207129349dfc877c10fd2b07570749c889f7b7829fe0449af01f7fea2406bade7432158c3940a08adcf35f4e7e9a7151b0130d992a939576f355eb46a8c23653a725cecc48fdd210ba8fe8e7c2f331c7d7d4e8b07c74f9dfaa5c6dae1368191c2a032ce5c07f8c758cc58ebb8c1b218ce2c8b1987d3b8a7ae1ee1f11e8a22b47e55591788548b18bd8f75a95b55bbb25265ef6db37e6d92c989f9855569057b5e3c89b9f879fed5671af42609192415f30317393c328d31e2a1f6ccb860295d734623022c786d4fd01559bcfd0a8b473000c6e8eae5e939c3007fc7214dc9b890739f68d2568270b4fc913c4d3e5646f1896bd8d78a0ac63768acfe5e43b12c17be3499db9fb622c13e0aead1808c7640e9d632763333f2af5473c4bfc6b7006782d5f43739be72a89a15dc0e551e2abd45488a96d9664e005b268d1574f03e2ce3f52f60bef1a805239af040da8f5cbb6c1be37041ed63a57bf5be60b4a097e6ae181d10fb41a6577dd3c591d1643c327f11c80484baaf2c1b39efb76b09cb4f6e187da1e32c6fe88c2d4225111a9c18da624ed1ac4b26bc9f5bb562ad842b6aba49bf49ace10b8f877a624626a41af3bd8423f32737d277b66e2b4e9aaf6984fab5ae</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">补充提示：密码为8位小写字母</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> Game </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 游戏心得 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>逆向记录（代号aria）</title>
      <link href="/2022/05/07/%E9%80%86%E5%90%91-aria/"/>
      <url>/2022/05/07/%E9%80%86%E5%90%91-aria/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>是新游戏喔~<br>残念，旧的，开服半年了…<br>这次为了逃避一下某高级计算机体系结构测试，简单看看。</p><span id="more"></span><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="小背景"><a href="#小背景" class="headerlink" title="小背景"></a>小背景</h2><p>开服时有扫过一眼，感觉麻烦就没动，今天看到有朋友问，就试试好了。<br>卖点大概是全程3D演出罢…印象中是回合制，似乎有些奢侈。<br>我的祖传MI6开最高品质卡得不行了，不过不好证明是优化问题还是硬件问题…</p><h2 id="初探——manifest与URL格式"><a href="#初探——manifest与URL格式" class="headerlink" title="初探——manifest与URL格式"></a>初探——manifest与URL格式</h2><p>manifest的包抓了一下，名字是</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cdn.app.*********-aria.com/v11401_14c67a0bd0d3776b19350*********ca49292a2d43127663a3a2427951f731f8/assetbundle/WebGL_Hash/bf892ddb3aa0f7a9e7597e*********f6fe215dc6861328821b763325953c0</span><br></pre></td></tr></table></figure><p>(打个电子码)<br>不得不说有点长，可以猜测v11401那一段是版本号+某个东西的sha256，assetbundle名字也被混淆为某个东西的sha256。分解一下就是<br><code>https://&#123;cdn地址&#125;/&#123;资源版本号相关&#125;/assetbundle/WebGL_hash/&#123;assetbundle的hash&#125;</code>。</p><p>资源版本号相关的可以每次拉取manifest的时候记录一下，就不需要去搞清楚如何计算的了。打开manifest看了一眼，里面记录是正常的asset名字，推测与<a href="../../../../2021/06/04/%E9%80%86%E5%90%91-ayaranbu/">之前某次研究</a>类似，即本地有一个自定义的sha256计算过程，需要走一下逆向。</p><h2 id="初探——角色剧情"><a href="#初探——角色剧情" class="headerlink" title="初探——角色剧情"></a>初探——角色剧情</h2><p>打开角色剧情看一下相关的文件，加载剧情期间下载了2个文件，猜测是剧情scripts、资源文件（包含语音、图片等）。用AssetStudio（后续简称AS）打开报错了——资源可能加密了。AS报错蕴含的信息量很大：因为如果是AES或者其他能破坏掉header的加密方法，AS不会将之视为有效的Unity assets，也就不会走读取流程；说明是使用了Padding或者局部字符替换等不伤害header的操作。</p><p>拖进hex editor一眼看出端倪——多个assetbundle头。<br><img src="/2022/05/07/%E9%80%86%E5%90%91-aria/multiple-headers.png" title="hex"></p><p>删掉第二个header前的部分即可正常读取，是简单的Padding法。但padding size不是定值，测试只下几个不同的assetbundle具有不同的size。经过读取可以得知上述2个文件分别是图片CG包、语音包。</p><p>剧情scripts不在上述文件内，很有可能是服务器下发的，一般而言它包含各种控制、剧情文本、剧情资源文件url。所以这个scripts对我们编写脚本作用最大。而服务器下发意味着经历过通信加密部分，我的话不到迫不得已完全不想碰这一部分，构造请求意味着要把所有需要计算的部分逆向搞清楚<del>也就是嫌麻烦</del>，参考以前写过的<a href="https://gist.github.com/sh0wer1ee/357aab7c091f89c982f1ee8203b4313e">alicerecode的代码</a>…所以先继续前进。</p><p>推进剧情到动态部分时追加下载了两个文件，走的URL格式为<br><code>https://&#123;cdn地址&#125;/&#123;资源版本号相关&#125;/Video/&#123;Video的hash&#125;</code>。不在assetbundle路径下说明没有像之前的某厂商，将mp4作为textasset打包成assetbundle。看了下hex里有ftypisom isomiso2avc1mp41等字样，说明就是raw mp4，真好。</p><h2 id="幕间——整理一下"><a href="#幕间——整理一下" class="headerlink" title="幕间——整理一下"></a>幕间——整理一下</h2><p>目标是提取CG，那么逆向需要弄清楚这些</p><ul><li>静态png：文件类型是assetbundle，如何正确进行读取、如何计算assetbundle的hash</li><li>动态mp4：文件类型是mp4，如何计算video的hash</li></ul><h2 id="正式研究——dumper-amp-IDA"><a href="#正式研究——dumper-amp-IDA" class="headerlink" title="正式研究——dumper &amp; IDA"></a>正式研究——dumper &amp; IDA</h2><p>首先寻找hash部分，在dump.cs里查找hash关键词，翻到最后可以看到</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Namespace: GeePlus.GPUL.AssetBundles</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AssetBundleUtils</span> <span class="comment">// TypeDefIndex: 13587</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Properties</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// Methods</span></span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">byte</span>[] <span class="title">ComputeHash</span>(<span class="params"><span class="built_in">byte</span>[] buffer</span>)</span> &#123; &#125; <span class="comment">// RVA: 0xDCBED8 Offset: 0xDCBED8 VA: 0xDCBED8</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">GetHashName</span>(<span class="params"><span class="built_in">string</span> assetBundleName, Hash128 assetBundleHash</span>)</span> &#123; &#125; <span class="comment">// RVA: 0xDC8630 Offset: 0xDC8630 VA: 0xDC8630</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">GetPaddingSize</span>(<span class="params"><span class="built_in">string</span> assetBundleName, Hash128 assetBundleHash</span>)</span> &#123; &#125; <span class="comment">// RVA: 0xDC87FC Offset: 0xDC87FC VA: 0xDC87FC</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> .ctor() &#123; &#125; <span class="comment">// RVA: 0xDCC044 Offset: 0xDCC044 VA: 0xDCC044</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结合命名空间，GetHashName应该是assetbundle的hash计算过程，GetPaddingSize就是开头填充的长度了。</p><p>video的话应该是这里</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Namespace: </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">ResourceHashMapper</span> <span class="comment">// TypeDefIndex: 8882</span></span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// Properties</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> VideoHashFormat &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    ...</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">GetVideoHashName</span>(<span class="params"><span class="built_in">string</span> videoPath</span>)</span> &#123; &#125; <span class="comment">// RVA: 0x1046DBC Offset: 0x1046DBC VA: 0x1046DBC</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">GetHashName</span>(<span class="params"><span class="built_in">string</span> hashFormat, <span class="built_in">string</span> srcPath</span>)</span> &#123; &#125; <span class="comment">// RVA: 0x1046E68 Offset: 0x1046E68 VA: 0x1046E68</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来就是静态分析了：</p><ul><li><strong>GetHashName(string assetBundleName, Hash128 assetBundleHash)</strong>:<br>在manifest里取得assetbundleName、assetbundleHash，将之按照<code>&#123;assetBundleName&#125;+&#123;assetBundleHash&#125;+gpl_ab</code>的格式构造一个字符串(加号也属于字符串而不是拼接)，对该字符串计算sha256即为结果。assetbundleHash保存格式是bytes[16]，需要按照02x格式化并拼接为hex string。</li><li><strong>GetPaddingSize(string assetBundleName, Hash128 assetBundleHash)</strong>:<br>似乎是直接对hash128字符串进行循环求值，结果与一个常数相减。但最后看麻了就用了偷懒的方法：读取整个文件，rfind到最后一个匹配的UnityFS头的位置，seek过去进行读取。可行性与开销分析：文件数量未超过1000、平均大小在1MB，存在可行性。</li><li><strong>GetVideoHashName(string videoPath)</strong>:<br>难点来了。流程是按照hashFormat去把videoPath格式化为一个字符串，计算sha256即为结果。问题在于，hashFormat疑似app初始化时服务器下发、而videoPath在剧情scripts中，也是服务器下发。</li></ul><p>此时遗留问题为，如何简单获取hashFormat与videoPath？猜测的话，由于app初始化了hashFormat作为全局变量，因此所有videoPath都需遵循此格式参与后续计算。考虑到CDN开销，视频文件应当唯一，因此hashFormat应当也是唯一且至少在<strong>一个资源版本期间</strong>不会发生变动。videoPath也有可能是遵循一定的格式，比如<code>&#123;unit_id&#125;_&#123;scene_id&#125;.mp4</code>，混淆前具有易读性更符合开发者的习惯。</p><p>总结一下就是我们直接从内存中扒出这两个变量即可。</p><h2 id="压轴——frida"><a href="#压轴——frida" class="headerlink" title="压轴——frida"></a>压轴——frida</h2><p>秒了<br><img src="/2022/05/07/%E9%80%86%E5%90%91-aria/frida-moviesalt.png" title="frida"></p><p>可以假定videoPath符合这样的格式：<code>ADV/movie_&#123;unit_id&#125;_&#123;scene_id&#125;.mp4</code>，视频有两个就是01与02，角色id根据静态资源来就好了。<br>hashFormat为<code>bless_turn_into_curse_&#123;videoPath&#125;</code>。（有点像寓言里bless不正确使用就会变成curse…不过有没有可能在讽刺搞逆向的¿）</p><p>编写脚本进行测试，结论正确。不过懒得发gist了，代码好丑…不过还是贴一下核心部分。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">INPUT_FORMAT = <span class="string">&#x27;&#123;0&#125;+&#123;1&#125;+gpl_ab&#x27;</span></span><br><span class="line">MP4_INPUT_FORMAT = <span class="string">&#x27;bless_turn_into_curse_&#123;0&#125;&#x27;</span></span><br><span class="line">MP4_1_FORMAT = <span class="string">&#x27;ADV/movie_&#123;0&#125;_01.mp4&#x27;</span></span><br><span class="line">MP4_2_FORMAT = <span class="string">&#x27;ADV/movie_&#123;0&#125;_02.mp4&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetHashName</span>(<span class="params">abName, abHash128=<span class="string">&#x27;&#x27;</span></span>):</span></span><br><span class="line">    inputStr = INPUT_FORMAT.<span class="built_in">format</span>(abName, abHash128) <span class="keyword">if</span> abHash128 <span class="keyword">else</span> MP4_INPUT_FORMAT.<span class="built_in">format</span>(abName)</span><br><span class="line">    hashRes = hashlib.sha256(inputStr.encode(<span class="string">&#x27;utf-8&#x27;</span>)).digest()</span><br><span class="line">    hashResHexStr = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">format</span>(x, <span class="string">&#x27;02x&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> hashRes)</span><br><span class="line">    <span class="keyword">return</span> hashResHexStr</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># let UnityPy read unpadded part</span></span><br><span class="line">index = f.read().rfind(<span class="string">b&#x27;UnityFS\x00\x00\x00\x00&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> index != -<span class="number">1</span>:</span><br><span class="line">        f.seek(index)</span><br><span class="line">        env = UnityPy.load(f.read())</span><br></pre></td></tr></table></figure><h1 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h1><p>如果hashFormat发生变动了，再走一遍frida即可解决。<br>嗯，就这样。</p>]]></content>
      
      
      <categories>
          
          <category> Hacking </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>逆向记录（代号grisen）</title>
      <link href="/2022/05/02/%E9%80%86%E5%90%91-grisen/"/>
      <url>/2022/05/02/%E9%80%86%E5%90%91-grisen/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>有朋友拜托我看一下某个四月份的新游戏…</p><span id="more"></span><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="小背景"><a href="#小背景" class="headerlink" title="小背景"></a>小背景</h2><p>教程不算长，播教学CG时f12看了眼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://game.**********.jp/AssetBundles/DmmR18Web/movie/harem/chara0000/be812c6b9482ba61e437eb836d479501a15b1f1c91d0acdda7c80009494d4a89.assetbundle?param=3f0ab091d7acb84ae47f834a6da5ab6d</span><br></pre></td></tr></table></figure><p>很眼熟</p><h2 id="开始研究"><a href="#开始研究" class="headerlink" title="开始研究"></a>开始研究</h2><p>感觉完全就是<a href="../../../../2021/06/04/%E9%80%86%E5%90%91-ayaranbu/">之前某次研究</a>里的<br>下载一份apk看了眼dump.cs，完 全 一 致</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Namespace: App</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">AssetBundleDownloadUtility</span> <span class="comment">// TypeDefIndex: 8700</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Fields</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> HASH_SALT; <span class="comment">// 0x0</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">int</span> HASH_COUNT; <span class="comment">// 0x8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Methods</span></span><br><span class="line"><span class="comment">// RVA: 0x145B014 Offset: 0x145B014 VA: 0x145B014</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">customizeWebRequest</span>(<span class="params">UnityWebRequest webRequest</span>)</span> &#123; &#125;</span><br><span class="line"><span class="comment">// RVA: 0x145B148 Offset: 0x145B148 VA: 0x145B148</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">makeAssetBundleFileNameHash</span>(<span class="params"><span class="built_in">string</span> assetBundlePath</span>)</span> &#123; &#125;</span><br><span class="line"><span class="comment">// RVA: 0x145B2C0 Offset: 0x145B2C0 VA: 0x145B2C0</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> .cctor() &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="静态分析"><a href="#静态分析" class="headerlink" title="静态分析"></a>静态分析</h2><p>  不是很需要再导一遍global metadata了，直接看吧<br>  测试代码如下（如果你能猜到是哪个游戏，改一下cdn链直接用吧，懒得传gist）：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> UnityPy <span class="comment">#run &#x27;pip install unitypy==1.6.7.2&#x27; first</span></span><br><span class="line"></span><br><span class="line">gurizaia_cdn_header = <span class="string">&#x27;https://game.***********.jp/AssetBundles/DmmR18Web/&#x27;</span></span><br><span class="line"></span><br><span class="line">HASH_SALT = <span class="string">&#x27;riznqfd7sj5rtw8gvfbur4fysdferto834hvfnds8&#x27;</span></span><br><span class="line">HASH_COUNT = <span class="number">11</span></span><br><span class="line">XOR_VAL = <span class="string">b&#x27;\x2C&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makeSha256Hash</span>(<span class="params">text, salt = HASH_SALT, loopHashCount = HASH_COUNT</span>):</span></span><br><span class="line">    text_salt = <span class="string">f&#x27;<span class="subst">&#123;text&#125;</span><span class="subst">&#123;salt&#125;</span>&#x27;</span></span><br><span class="line">    b_text_salt = text_salt.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(loopHashCount):</span><br><span class="line">        <span class="keyword">if</span> i &gt;= <span class="number">1</span>:</span><br><span class="line">            b_text_salt = baxor(b_text_salt, XOR_VAL * <span class="built_in">len</span>(b_text_salt))</span><br><span class="line">        b_text_salt = hashlib.sha256(b_text_salt).digest()</span><br><span class="line">    hashRes = res = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">format</span>(x, <span class="string">&#x27;02x&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> b_text_salt)</span><br><span class="line">    <span class="keyword">return</span> hashRes</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">baxor</span>(<span class="params">ba1, ba2</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(ba1, ba2))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump_filelist</span>(<span class="params">manifest, output</span>):</span></span><br><span class="line">    env = UnityPy.load(manifest)</span><br><span class="line">    <span class="keyword">for</span> o <span class="keyword">in</span> env.objects:</span><br><span class="line">        data = o.read()</span><br><span class="line">        <span class="keyword">if</span> data.name == <span class="string">&#x27;AssetBundleManifest&#x27;</span>:</span><br><span class="line">            parsed_list = []</span><br><span class="line">            <span class="keyword">for</span> key <span class="keyword">in</span> data.type_tree[<span class="string">&#x27;AssetBundleNames&#x27;</span>]:</span><br><span class="line">                parsed_list.append(data.type_tree[<span class="string">&#x27;AssetBundleNames&#x27;</span>][key])</span><br><span class="line">            parsed_list.sort()</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(output, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8-sig&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                <span class="keyword">for</span> p <span class="keyword">in</span> parsed_list:</span><br><span class="line">                    dirname, basename = os.path.split(p)</span><br><span class="line">                    filename, fileext = os.path.splitext(basename)</span><br><span class="line">                    hashname = makeSha256Hash(filename)</span><br><span class="line">                    f.write(<span class="string">f&#x27;<span class="subst">&#123;p&#125;</span>,<span class="subst">&#123;gurizaia_cdn_header&#125;</span><span class="subst">&#123;dirname&#125;</span>/<span class="subst">&#123;hashname&#125;</span><span class="subst">&#123;fileext&#125;</span>\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    response = urllib.request.urlopen(<span class="string">f&#x27;<span class="subst">&#123;gurizaia_cdn_header&#125;</span>DmmR18Web&#x27;</span>).read()</span><br><span class="line">    dump_filelist(response, <span class="string">&#x27;manifest.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>这也能祖传代码？<br>我为什么要水这一篇浪费读者时间…就是换换参数</p>]]></content>
      
      
      <categories>
          
          <category> Hacking </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>逆向记录（代号legeclo）</title>
      <link href="/2021/10/26/%E9%80%86%E5%90%91-legeclo/"/>
      <url>/2021/10/26/%E9%80%86%E5%90%91-legeclo/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>之前事前登录很久的游戏开服了，就上去看了一下。其实挺期待的<del>わくわく</del><br>这次的卖点是播片全部60帧，值得注意的是用了Criware。<br>所以就简要谈两句，研究时间也没多长，所以肯定不会非常全面。</p><p>剧透：总体而言还是高估了对手（？</p><span id="more"></span><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="小背景"><a href="#小背景" class="headerlink" title="小背景"></a>小背景</h2><p>背景就不多说了，就是上次奋发图强大改assetname的那家。<br>所以这次一定准备了非常强力的加密吧！<br>所以这次一定准备了非常强力的加密吧？（星战meme</p><p>本次目标简简单单，为以下三点：</p><ul><li>获取完整的资源爬取方式</li><li>获取Criware Key</li><li>获取主数据库加密Key</li></ul><h2 id="网页版初探"><a href="#网页版初探" class="headerlink" title="网页版初探"></a>网页版初探</h2><p>网页肯定是wasm，怀念当年几个cocos2d的厂还能阅读js源码。期间一直提示连接错误，还以为是太火热服务器baozhale，结果是服务器要求东京时区，怒</p><p>游戏开局就能跳所有教程，看CG时可以直接看目标片段（其他游戏里需要至少阅读完毕一次剧情），用户体验方面确实是下了功夫。很多游戏一上来新手教程直接塞满还不能跳过，被迫推主线的枯燥副本，而大部分玩家期待的是开局送抽抽卡环节吧。可能是防止刷初始，不过倒是真的有日游记录全服リセマラ并根据人数进行奖励的。本质应该是无root手工刷初始通常会下载大量数据，CDN的钱划不来吧，因此有的游戏甚至实装了仅删除用户存档的功能，实现winwin。</p><p>在阅读剧情时发现会先下载故事script，从中按需下载CG，url未加密但角色都是代号，又双叒叕不加密是吧。</p><p>主数据库是csv压zip打包，而且设了密码。反正我真的是第一次见到，惊呆了<br><img src="/2021/10/26/%E9%80%86%E5%90%91-legeclo/deczip.png" title="zip"></p><p>此外还有一个经典manifest，不包括cg的样子。但你可以从里面Spine小人的数据特征（*.atlas.txt）反推角色代号，按照URL格式就可以爬到所有CG，<strong>目标一完成</strong>。试着写了一个脚本结果真就全弄下来了。那么还有什么继续的必要吗（？</p><p>然后usm视频文件扔到播放器里居然直接播了，都不需要 Criware Key…<strong>目标三完成</strong>。现在落幕太早了，看看压缩包密码吧。</p><h2 id="IDA打头阵"><a href="#IDA打头阵" class="headerlink" title="IDA打头阵"></a>IDA打头阵</h2><p>好像出了点问题，静态分析没处理好struct，跳了几步看得头晕，摸了罢。猜测是初始化期间服务器下发。</p><h2 id="Frida-Hook"><a href="#Frida-Hook" class="headerlink" title="Frida Hook"></a>Frida Hook</h2><p>秒了<br><img src="/2021/10/26/%E9%80%86%E5%90%91-legeclo/frida.png" title="frida"></p><p>稍微读了一下包里的主数据库，可以用来获取全角色代号（但没必要），不过里面有未实装圣诞角色还是蛮有趣的。</p><h2 id="官方嘲讽"><a href="#官方嘲讽" class="headerlink" title="官方嘲讽"></a>官方嘲讽</h2><p>安卓版安装完毕了，右上角怎么有个下载全部数据按钮..？<br>跑到应用目录下怎么所有CG都在？<br>WTF</p><p>好像完全没学到什么，不过CG还是很好看，玩是不可能玩的<br>唉~</p>]]></content>
      
      
      <categories>
          
          <category> Hacking </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>杂记</title>
      <link href="/2021/09/20/%E6%9D%82%E8%AE%B0/"/>
      <url>/2021/09/20/%E6%9D%82%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="c610510d1b35c848acd4847b5005fbf047a9bb458b09bff118de28b7d3674fa4">c35d7fdc7288e10848092a2ea64231d1a825d09314c8f4ab88fe3e437c8b886ce73feeffae5f5fa0a6cc646d81a95355c52cd71752e8ae68a1ca16046bee80b6d09d8a90a8c8ad98e8857bbbd0e420aee0598be6257e32582e8589731e55d4f454c3f7788e1a5fd46ce5f4012f0439bd5bf5850589f6cfb1e6a47c97deb4085bb890233e9bf58505c96ad2434a5a01e566a2216fb37be26a85a676c7ace0e7cef50891db89685759577846ee722d4bd62cec07f547a286f903168b3cefcc61216bf5b09420ac4e44e7216585dac3894108a1204d6f74431f31f16e1497b76c26d21860c4424c4015b879c37f67d9f2b2f1674df80f235c407be23d68e249c170e25c0cce1c90198a4bcabb97f8d5d59bd4e7823788979ad188fa22f92021745a5c585280df45622e03965c0f21a4c4d453f9abc775713765cbfc7a78f3b1ab15ee4a25d31ac0c04b9e5d804097ac0d9efc074a6463ace465016737fa7b3b673d5028107cd0e6af9205b025f39cb781c413738bf35c59dd7a8a5879901665653fc95d4f6645bbed2b6d2a36f7ce123d7e58c5d315e39d38ab9178702bbc7e4a00aa1eb7795f8c7f57d5276dee76016f94a227d92162ce89f0166e107ea924bfb3346d54ad73d263897edc669857f4d351680f65be5e2c4c7d427d59e443fa80b9d9259fbed6d58fa10022bc507877e1e64caab24b61f45ef2a0c3867ca12a906f68dcb9853a0a30e56aa3ec027f5c0060a4c4e40359152dc8faedf7953aa367448b46d5d04798521bf5f3e85bc9a44bad3302decffacd4a341eaf41cb0313559d87231a2dfd708f4bef93bfd89355fe393d2b98b831ef9cf1ac42ca091d7262f1c091197be4b9c9618818ca439fa2e33cdf187c1124a681535ecdc0734e392623492a4269f4b81fea5d7c5e37f04fec8bdefe948fe11c4e879789bcdb641985cd1ea4f0076b427ebb7d6ce25f7c8faf130f80d2c0b8390b4ff04c72dd8691e3685bfba8bf430556306847a11b2c61298f2eb5706b5ba60ba6a9af9fd7346788c6bb94607bc283e89d96cafa039c92b8f4623a985ad4887ce7b86ed617ee0fbd560e160e5631c6517583f345f81aced23230b958b01e8eb2c0af9d5ec5e189051444e19b02634f500b38acd7ae2ad57a33b24a8b4e20a9502eb0655a559d809b05489f41202324546645860dd7cae49bb49f4f499dceadd13f5fb676209af0f612dfe97315f13dccfc6759a797166e3ea9680ec1789296ce01d6ad72b0b8c14eabe7ed7c63190f211d64df5cbd335e1df6d27507aa5d432a8eb20550b3cd9a3547aafc41293c1c12eb25fa606d3534dbe4417832d9ac5dfa9584b5833ae4827fb0707f13d7d5e91e47f383c0c319bd01eb88d91e8f6dbeeda350c425b4d3bb54d25e123fde73471446bee5448d8fdf44a7e5460e380d13ffb3be5c9d8188e72880fd29c13ebf84a4fc41d2163d80deae8da62988302aa73b5ccbf4ccac4bb85b07aa26e2ca94932777d60672af8f5f34ca9e44a75621b42ea411d6d46b5a9b6038f6ed7a5d4d8212b2d637c67d31c726b4c910ea3955d6bf362ab439a371e3e84e5acf9008d25e2c2f463685ab53d496eece6b44305af3d8b149ffe19981a7720677a73262cc8f9aac3e6c3155701b156fa2537e736747aa5418bcae6ab4e11bad16e144ca55b21c8d194371dfaa0a796aabdc903e6fcc77e910f4b9d14a4460ebfff5324c341cfc4971bbae892986128674b4bba8bd5c5a8b98bff64c057a37c5ec015903d0903c632d0cd65dcfb4f944b1fda142a911619358453a1875b85fb3377fd89d730b23e6cddc5dc001ecff1e59df135242284bb7f4eb53a853e9e0722f2461ed45a9a5928b5adbae66377078aae6b5c348d02a2b31f682a89b896573516346ec0b430f62c1d403f90aa5042d3fdefd25d54673bc113cc769e833d5695c85ca22f5c27884e0dcb7f44e987cb0bec83124fa7c83aceb1b5d95f7f8d729bbad962e79f0f8a3152b039d44945e5a944a17c5e813c5424868d03d589050eca07f222893f5ee3e2cf13b37fa4e2be4228d25f5fa8d951e59c98ae4b7925e0528fea8440f43cddeeb4c9c6b839cf4b1bc47aeefca291c76e012abd38d1b71a43a318799b8254a9d895a339da5120b57f5efdd5b08558774b596de3880d04f97ba0ac7a9abb27ded5758928090b33d33c9baa795ae8381ccc43fd04023066f7f70ae383a2bed5d000a1bd955f1ce5abb9aa955a22821b9e52d7a37eb482f7452702a002f0bfdc3027c6e2ee9ea8029f9f43ea3c850aa3cd20be43658555b8ca059aba7e91f90dd6b4cdda9089fbf4c2e920552cc881835c400d3e80730a956a02dad0a5ef239d4efd5b091fd4b907b7ec786c85b241ff772668a986ff2e19ab75be6b914ceae3b23e8a2d42a2b07a164a8b1d70fca00b842639ac95630a8c3a2d4c7122cfae11591f03fde4c8ea6ac1d04703ea56d90345d5794e3dc7f56e634ac6e96c70f1db707ff272118c72cac0467cc6e19349e185284032c6c39e455b9dcc4dcf553ff0bbede97843b1aed9b7e510cfdd7c00c0abf0041da9da42f167b149120d1c816445783c0f9eea095b73776135135ee8d264d765fc2e1ebee85323711e6bbc4a68d435807b5a2470bfe13a735811ca859571c96a8f90cff5ff9282646709f1ee95ddc609f54d1153f1a94362e49269557faa3f8ecacd84b39ec0655b308874ad0ab7c8f8dbfb9afc3f702cf433b955bc319931cda607cdb0b355d2e42e80c313966a98ad84d92d18209b915e5ea4c3ea0cad12b9e93583d03299ef7910a9b8639705e7944a6580a064748369e532cd192c2df8593ea6201d2968a32642ac222df517466a36a55cd7eff5207091f6a306e8036b15391eec4fca9204e56b8811bc7d844b70b77a1931ad26a3deb28cc67a1250c010ef7e04f3f5a17a925b847f1ca0dbd65d28e5a7abb1ac45d08373096ae7de659c4b199a4498adafcf3a721cfd7cd9a40ab069a555a195950695c0b6606ed3792d9c07e59422d9acb3ce537c7d4b51dfcb2895f1777f6c0370991d8a104a69daf4cbf7585466145efb3e27b03dbb49dccf21cfb910c5bd8dd080201c3c19f9f403e9a6a43dda622d5e9481f4a768966dfcf47baaf7f00ca6a079d84cf4e4a162f60cbc4d1a84f1b7a0d31fd6f1fefca0f7d758b67da4de18d5f631c76e0ba3a93727dbb9468be3af15b9ede4eb4a65b6bb0053462821b17166d361225bdccea13a2afb9803323016c42793d4a332dad6154e103bb6e76176592b836d0b3d851707ba058be0e802ad8c0a953515626c468149627187aa0d7d8a1598471d5aaa4955ac0fea687370ce123ebf760522bbf060eb38bb5c3553ab882e0802f307c60a669372863da5e197842fc3ee22c4d191c1f859152b76c20aae506ad8f91a3c7192b97a6f57ce9bc54399ed6a68ce1dd67e9e0da7a40a00cee163b1393057b652ef45764672160b6d4377e9e116c61e51d960bdd32d7d1c8fc80a5623ce7141ef624e381d9bfa9c693bf424257a4201c27a8ee9b66060b19b0708dc02e002ccbff1eeb6285f0f506ca6997bf4976fc949dc925f8c5d939918769e476bc940a4423f6c0f42021daf018b84d253bfc09e957d35e2c2bc5258fb2d02319394b1703e963c5efa1bb2b8cc7e83004bdb8c9f05d8d8a53088d219b136be9b4683628b26957b17f76afeea6702c28c1086ce72c3175ef85bf88aec1ab1aef8957aa15ab68ad684b4d5dac7f111f15a89cbeb945aeaf30120e4771e5643b9a6f536feefa8e81fbf26190e5bfab75e28a794101936371f05e581493ae5f00a0162e36c3818ae33b09b253352e2f978668f3e8fdf13b6b4ef11c6d73a2ae5e19f3e4d08a1e8a88a9c08e6194ffe8796a02fb58ab004a06050b0bcec990a295f135bd30d103abb31de7f55e4250017b25c5401327719b70489ad289aaa73b0037c17f572f368f7d6700c98796fbd4e0e1083e67a0efc33b2790eb19639dacd7de51e9f834b7c7238ed1699315fd68df4fbc6a2e78bed46f1ee3cb411c9d8163af197e99ba651812b2bf41769d8341b80107baeb91e3fd1a80f1d6b0bf24d6f04d3fe5ccc32f36da3408b0b186dc5a4b2df696d33cd019b0dc850aa1bab4a0f58f3064956ba48cd73841a4865e0fb1742f330b1e9b1a4d88f2c94853409719322a2c5ba726d195f942d09d2d25ea00f02b680d28d5899a78388d5c01670dc6901e05ec88b340317b86d91ab94dcbd37034e7179b635d7d32228d08951fcbef7eecb367461acaca842d1c3afde0ea04d4f45b72ddbd9312c3ceed606a1091b6e2e9896064eec3a851eee987953a695458beaa9f514b3cb993cadb7318a91b1994b76c58ffcfd4226bdca0ecc39ed27d272f101295bdfc234484e56fe5111d53f50470d1102d898ac1a2f5d7e14336b69999ef980330c7bc948364278c7ed84015bec49c10acb5ebabab70b3ff7834488563bf9fcee9d2e6d257462504142dc04cfd9d5f716d76182a10bcb989884de677b411b1f07ed4e2bb491c3c2ebbfae13b318b8040fb9acaca97506d8d77470c8452db721f195ab524735b37a7aa9a60753904ffdb9e6cf4c8ee1e5e66ab9388c1f993c07217a85f32957be7a5acdfad0c6b604c36b2b187cb9f72012ee1e6d03b9106f4916c6959846acbbc28661af050692a83e6e9a5455c57eca730fbc9d0363541cc4aef3c1613d787d46adec86ea592c0307687e16dbdfdb664609ec2b091941a6030f1b9f79107e57bd8b85903d41b2a308cc593cd46e5654566c60a50f7503be090e321ee3f9af3c6e58bcb4ee8e0f034e06249b0f1979b30eeee998ea9b4be2eeaa78a4a7b621e2f78ca4a620e5025fda18445b3171258f29d64d61614e778e6b8ccbff351c7336cc3d1b02f8392c5b822a80fd6444d831bdcfb07b7c3f897ce3ae21a20a63ad14ceafff75c3f72e799e6ac226dbf581b45695b1fdc025de281bcb83ae5c1fdceac30b9f36aa03385a936bc07efaaff1f7552c3cbe2b0329506df9607e544b5ef30f2c0856f1d2d9d0ae4294bb8805e4c810ba40822870cfaa23bf7764d6d33840d577812dc17c48ec725fce272d258c00bc92cabfd79b38cbffbdb9573e7d5d187771b394bac52a4c3cde72a9bd7f915a802af6e772af66ddc934ec2cb84ad19cbc2fda5a3ac8d62a1dfdd78af1b1a582d10815f397d01e320301e5031281581c8a1877d9ce4e5da73c34b0bb53ff4674f2c20a3da0bf64fcf5bb3280b8f9627d880846eb689b2d1f09bd89909ff81c272d158f0172c80eaa5ffcecdd196b5ad3afcf78c5cc77ad0828ad7f23dde04b99479024957003fb3cce1ddd0c10f286d963e957649c1814827f97090554fceae910691b4674fc9b249a61d0c05ce491437790221d5579c9942980b038e90124e1f36133a1bb00862e8535574fd0ec02c97698329803952d211f39d9bd6101d996ac313f16a42cbc2c07d72dff858b9bfdf543dc7b5705767a8ddb152ca15d5eee52884102767be4f3950a46924310edc0d74f56c04a39abb527f4dffc97853d3928deff0d264f1358679d06091f95b44f219acd3844e8b2bdc440dd2bb5ff7c47c2985e650d0d21ca91d09125296a7d6bce12d00606426d88d456f407dce9a66c8294dd3e535fea9e331606e8e10c29c0db6c7c23ff4925785fbed0be60372dca7b390751760a6b59084163204257690bdaa834280f305716679048b4c9da9e4de544fcff9be4546db12827c569f42c3e1e97b6f3a363115ac82de0f98c453127f19518a5f958e6313f57271defefa8343fdf5fc0ecc0ac74d17d40b616bd829466da191a4395454e7c1ae5ea680aef34a8926d57ef62b5fe0b5a56f4fb9358d27a09793863739880823c6ddebbfe465f5ad9385b64d1eb4361c5928202e5c31502c316ca2fba265da2ea95a1edabea08fc0a5b46ad401f12f7383d5b98a8982cd75ca0648911332ca945737543e04c0a124ba01340a9c333c4f72c3f9a8d57466e2ae5f3a7982b5e03534d4770c04b755356980303d01ac2995c25d9d559259753eae59629212f803a151d3a1a49458d37c56c93a195b734e9865f23c25b0c8f317f743352988d3732daa018ebe852749398bf40c8ba59a8237ba03370cf5396a41edfce6204030212d63aafc61ca8cd1669fd75601c03f727040dc4f6c2a6a2a433b669a7d99a0f503e408e71cedac2b0eb0f773f8f1462a00714b249897df86df2381ebfc8982b142054192445e7eb7e3734c6fcd708e9e96c1649e653c8f9c8543ef13e7e33af3e5bb422f20313ee26b63b8db493b9b017078a0b811d4838db55f7a53d846920a30fe839feedb31b1500dd9a7da4e58d22e4189681677a092158bb934326c5d00538aa22a09856314aea416b6ecab69fa8b7cc132ec6f0115ede9b332bfd4c2b03c99904930ea4ae36eb4da3b6cf69605c0559eabd106a5a3f3fbd2bfde54a4cc7f13e99adaa6568ddbc76af3bd23e77efd1d672559ced019f0ed21b721030021d67d6203afb9d95de980c7bf83c46e85fcc9fba044d571099bdf3f4f3a2ec3688547efe31aa58b870cce3f49f0ba1cdc17bd875c64197adac81e97b6dc29b627289d4c3ab210be707a24769b330bdf0c11414c2253aa8a4c4f1b57a70a79bb6c25bfce2ff58819ca23b1b8acc52620f82b3524fe840280bfcc3de51a1ffb7cbcca1db9ed8c782beb5b505bb94097228ac5c6f83c0b0f2598234d89d9316af0e0530e948b6028c14967e9d247b3273b266fd684e5e812e2f00db8a02e3acd0f4afb4d00c5a66c86f303c57a3a72dab6661106af82406325032638cc858eb93509dfcaee38c0794c9d0b4c135eef293063e164a086720b83253f06a959117dfc313b0c60de3d9ff075c3a58c5ca6d4e311ad33c3fc943103d3b4c51821bb13905490992f127d8fec126d9b67429af3354a70f18bfeacb4f390e2c37a4a2c32e7fa48ecb51473352967dd04a7383571060889d220ec6c342b8e5e11ef48cfd6f01ff503f12368faaf9ccd09cbc3e067e7dfd6616ccdab1b337b298bf5ae38013200296928d71bf41d502b59b8a723b8f030f639888e9944f7fa9527a970bdbcd8ae77bdba6ba40bbe8d9d99af268476e5b75330863be70f4b8bf8c73ba8521ebc177ad8bed0e232d6d22312767a6fa6e06596aa14e5667be9847087171d9741527913e6f8e924cc94e20aa8e1c7dbbf5d3e8a198076514416c500739c567dbd062cda3d414d5eba6f973b60554b87c158f004223a79558efc67811b64a7207ea1417c51277bed6b3f8fa13febccecdec1be8d90a31e01f6bfb42d8b141f5e14a05fcb3fb0d0c38a0516b2087f5744e164427f44b912039802f3492f00505897d402ebf5ad4249c739ce47beb6b9ac5a6f885f6623f32a6c12caa20b1fa89bb7fa5d33fdd61f263f1db438739efded05945dc113ce84138da12a58fa713a7dcb4ef98f5f701bbba10c95f4b5ae26a0dfc87fe1b28f21e5490ccf7ddc2138e8e12805670f7ee188de7ef4b8eb539e24e2a788b7041f5f51322ba859fe20</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">请使用杂货间钥匙</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 记录 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>逆向记录（代号ayaranbu）</title>
      <link href="/2021/06/04/%E9%80%86%E5%90%91-ayaranbu/"/>
      <url>/2021/06/04/%E9%80%86%E5%90%91-ayaranbu/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近备战艾尔登法环，晚上一有时间就去重温《黑暗之魂2 原罪学者版》，不得不说这一作还是最耐玩的，即使是高周目也有很强的可玩性，尤其是3个极为优秀的DLC。<br>主要是之前的爬取某页游CG的脚本突然崩了，今天花了一些时间研究了改动并重写了脚本，简单记录一下过程。</p><span id="more"></span><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="小背景"><a href="#小背景" class="headerlink" title="小背景"></a>小背景</h2><p>厂商的名字以及游戏名字还是保密吧，主要是我和这个厂商蛮有缘分的…所以尽管这次研究也没什么困难，我还是稍微记录一下好了。</p><p>这厂商的上一个游戏（代号…UT吧）让我第一次接触解包。UT美工质量相当优秀，但优化不得不说真的拉，打副本闪退可谓是家常便饭。试想想你打最高难度团灭，使用了抽卡用货币进行复活，复活玩打着打着闪退了，货币还消耗了不给返还…所以我肯定是不玩的，每次更新都在某站对应的画廊等大佬更新CG。但是好景不长，大佬终于弃坑跑路了，作为伸手党的我就傻眼了。当时对WebGL也只是略知一二，我尝试按了F12去查看已有角色的CG，结果发现资源URL是全明文而且没有任何防爬的验证措施（比如session token cookie之类的）。格式就是质朴的角色id相关，这样的话，只要在指定范围按URL pattern去遍历发送请求，服务器返回200的话保存下来就能拉取到所有CG了。听起来非常暴力，but it works. 当时正好学了一天的Python，就按照以上的思路写了上古版本的资源爬取代码。</p><p>下载下来的数据是Unity的assetbundle，但当时显然是不知道这个“打不开”的二进制文件是什么东西，丢进hex editor看到了UnityFS的字样，然后才了解到相关知识。这个游戏实质是把mp4作为textasset打包的。所以在游戏中从静态CG过渡到动态CG时会卡一下，大概就是加载视频文件的开销吧…现在有钱的厂一般会使用Criware这个强大的音视频中间件。</p><p>↓ 凭借着下图这个简陋的脚本（初版），我在那个画廊评论区以mega链接的形式更新剩余的mp4文件。</p><p><img src="/2021/06/04/%E9%80%86%E5%90%91-ayaranbu/01.png" title="初代目代码"></p><p>穷举id可能会触发大量403&#x2F;404，可能会导致厂商检查服务器log时注意到。</p><p>关服后此厂商推出了新的页游，资源存储方式与这个一模一样…一样到老的脚本直接改一下cdn链接就能继续上岗了，就这样继续用了一年半。顺便一提游戏优化还是一言难尽，和前作一样卡得要死。<br>不久后的一次更新后（就在前几天），脚本跑了根本就没动静，一看log返回的全是404，心想着可能还在维护服务器，就等到晚上再跑了一遍，还是404。<br>进游戏一看完全没有在维护，爬下manifest文件表一看文件确实还是那种格式。最后就直接开了个角色剧情抓包一看，是一长串的hash。<br>↓F12</p><p><img src="/2021/06/04/%E9%80%86%E5%90%91-ayaranbu/02.png" title="F12"></p><h2 id="开始研究"><a href="#开始研究" class="headerlink" title="开始研究"></a>开始研究</h2><p>看一下 url 格式：<br><code>https://***.******.com/AssetBundles/DmmR18Web/ui/73285980484e56353254c0089894d7c46b218a8f7d0fc87652eaf93cb16c7589.assetbundle</code><br>在manifest中的文件名依然是明文，但请求URL是一串巨长的字符（这个长度应该是sha256），应该是做了hash处理，至于如何做的hash，那就需要静态分析了。</p><p>从安卓端掏出lib和metadata，处理一下丢进ida。趁着ida在跑打开<code>dump.cs</code>寻觅一下变换函数的位置。<br>这个时候一般是从发送下载请求的函数入手，从关键字可以检索到<code>AssetBundleDownloadUtility</code>类，简单扫一下结构，确实是我们要找的。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Namespace: App</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">AssetBundleDownloadUtility</span> <span class="comment">// TypeDefIndex: 8847</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Fields</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> HASH_SALT; <span class="comment">// 0x0</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">int</span> HASH_COUNT; <span class="comment">// 0x8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Methods</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">customizeWebRequest</span>(<span class="params">UnityWebRequest webRequest</span>)</span>; <span class="comment">// RVA: 0x26B8EA4 Offset: 0x26B8EA4</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">makeAssetBundleFileNameHash</span>(<span class="params"><span class="built_in">string</span> assetBundlePath</span>)</span>; <span class="comment">// RVA: 0x26B8FC8 Offset: 0x26B8FC8</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> .cctor(); <span class="comment">// RVA: 0x26B9040 Offset: 0x26B9040</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>成员变量暗示可能对文件名进行了加盐操作，以及循环计算了一定次数的hash，目标函数应该为<code>makeAssetBundleFileNameHash</code>。至此准备工作完成。</p><h2 id="静态分析"><a href="#静态分析" class="headerlink" title="静态分析"></a>静态分析</h2><p>↓ 打开<code>AssetBundleDownloadUtility</code>类，此类静态变量一般会在ctor或者cctor等constructor中进行值的初始化。<br><img src="/2021/06/04/%E9%80%86%E5%90%91-ayaranbu/03.png" title="constructor"><br>循环次数设为了 14，根据<code>StringLiteral_6415</code>对应的字符串我们也拿到了salt。<br>然后分析目标函数：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Namespace: GameFrame</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">AssetBundleUtility</span> <span class="comment">// TypeDefIndex: 5240</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Methods</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">makeHashAssetBundleFilePath</span>(<span class="params"><span class="built_in">string</span> assetBundlePath, <span class="built_in">string</span> salt, optional <span class="built_in">int</span> loopHashCount</span>)</span>; <span class="comment">// RVA: 0x183DC14 Offset: 0x183DC14</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/06/04/%E9%80%86%E5%90%91-ayaranbu/04.png" title="makeHashAssetBundleFilePath"><br>↑ 图中给临时变量进行更名操作方便分析，画圈处为关键代码，即将URL中文件名主体（不含目录以及后缀）替换为<code>makeSha256Hash</code>返回的值，其中该函数的输入为文件名主体、循环次数以及盐。<br><img src="/2021/06/04/%E9%80%86%E5%90%91-ayaranbu/05.png" title="makeSha256Hash 01"><br>↑ 如上图，清晰的do-while循环。（<code>_ts</code>是 text 和 salt 拼接后的字符串，在上面没有截到。）</p><ul><li>A 区域表示在第一次循环之后，对该字符串的每个 byte 与<code>0x2C</code>相异或。</li><li>B 区域对处理后的字符串计算 sha256。</li><li>执行顺序显然是 sha256-&gt;异或-&gt;sha256…异或-&gt;sha256<br><img src="/2021/06/04/%E9%80%86%E5%90%91-ayaranbu/06.png" title="makeSha256Hash 02"><br>↑ 接下来就很简单了，<code>StringLiteral_2016</code>对应的字符串是<code>x2</code>，联想 url 的结构，以及 C#格式化字符串的参数，就是将最终的 bytearray 转为 Hex string。<br>分析完毕，测试代码如下：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="comment"># App.AssetBundleDownloadUtility$$.cctor</span></span><br><span class="line">HASH_SALT = <span class="string">&#x27;******************************&#x27;</span><span class="comment"># private</span></span><br><span class="line">HASH_COUNT = <span class="number">14</span></span><br><span class="line">XOR_VAL = <span class="string">b&#x27;\x2C&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># GameFrame.HashUtility$$makeSha256Hash</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makeSha256Hash</span>(<span class="params">text, salt = HASH_SALT, loopHashCount = HASH_COUNT</span>):</span></span><br><span class="line">    text_salt = <span class="string">f&#x27;<span class="subst">&#123;text&#125;</span><span class="subst">&#123;salt&#125;</span>&#x27;</span></span><br><span class="line">    b_text_salt = text_salt.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(loopHashCount):</span><br><span class="line">        <span class="keyword">if</span> i &gt;= <span class="number">1</span>:</span><br><span class="line">            b_text_salt = baxor(b_text_salt, XOR_VAL * <span class="built_in">len</span>(b_text_salt))</span><br><span class="line">        b_text_salt = hashlib.sha256(b_text_salt).digest()<span class="comment"># not hexdigest()</span></span><br><span class="line">    hashRes = res = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">format</span>(x, <span class="string">&#x27;02x&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> b_text_salt)</span><br><span class="line">    <span class="built_in">print</span>(hashRes)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">baxor</span>(<span class="params">ba1, ba2</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(ba1, ba2))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    makeSha256Hash(<span class="string">&#x27;movie0188_scene01.mp4&#x27;</span>)</span><br><span class="line">    <span class="comment"># output: fffefb316d21387f88fc4de22e164ec3bb461b8f1af2a0da9faff190f6d81cc3</span></span><br></pre></td></tr></table></figure><p>↓ 与实际结果测试，结果无误，问题解决。<br><img src="/2021/06/04/%E9%80%86%E5%90%91-ayaranbu/07.png" title="f12 confirmed"><br>然后顺便写了一份根据文件表，仅下载更新档的脚本，自动化掉了之前繁琐的操作。</p><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>总体感觉很适合新人静态分析入门）<br>可以frida插一下<code>0x183DC14</code>拉到几个参数，不过要弄清过程还是静态分析更为适合一些，后面我们可能会用到frida这个强大的工具。</p>]]></content>
      
      
      <categories>
          
          <category> Hacking </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>梦记录</title>
      <link href="/2021/05/16/%E6%A2%A6%E8%AE%B0%E5%BD%95/"/>
      <url>/2021/05/16/%E6%A2%A6%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="89364756b6e2e8e05043c210988e8caf40d423fcaea426a6e689a723ee53b28e">c35d7fdc7288e10848092a2ea64231d1a825d09314c8f4ab88fe3e437c8b886c2b06f5ee01ed899d65124352fe1ee20509e035d61c5d8992400b2dd95415613ea164f164e83f4bb1011dc350f7e4b17ae324f24e82540b6afb88e72f298e0559a397903c5ae6a3222be8c3ef1873b3aaaf55d18ae02b08f1008c6474fbc9fbbabbfb3d08aaabe372827b9268ffbde26d5292eb538e008001da214852d5076ee806edc4be52ac70140de627a9bbca85ce48f5669362ca44e217a07d841560b4c1171550b352e535ef344cfdc2bceb3575f86af415c68767fd3d5b0ab6343ed1da19069bf5f64832d1704a9b1a7fc47b09d923650e7933d192a55c93a4762128f7331fd8ccd54c6ab6540a028778a79ba97ea25a05c3a83887fa73e4cf4107953c346b7e056d5c4acda2995634c67aedcbccae3179aed6e5514ee9b22a4c65dfef13a634dbebcf0a87ee21b885174c90742cde4cf730dac2058a0cc8d650d797b2045057331902909e06ef14b0193d4948ac955132c5003592e3f5bcc8b168119aaad4023a0502c17ff2c2a19c87f7cd7c46cde1eff1e271dde37d74a89fee31f6adab77b6e3a0bb7e01e8858d9116859b68ccb97480576eb54217dacea2e291c5b925a22b3b3a449bcbf4cafb34d8f1d8e565cb7530669d49d7aad6bc6d13960f6654208fe59a00809010cfa29688bc4ef27ebe5ae067e382641f115de141fa06545b36f54163d5449917da947a096b32bc633fc2751377faf43990d0fdd3b0bdcc62663a98bbf9c9bfeed414b393f89ed0c2913057add34cd6973fae6f073935cc7e6c964e8c5890e875c609a14c469686e8be5c58e4d2cff1b780a8890ce6039e7fc73d13b335f431a1177f0f533c6f13af6196be0ec2863283c5e83eaf4dbe1ded73470f5d50b6ac872005b6fca331ceae52df17439e4ae5d9ebf6fa8f38b48603b1503defdd734e6f71beb93794d84d091a7c1e12bd98e405edbc3d1fd17298f645f17df0afffd1fad51cc2d8f3b2e4c8578594bbaf5d0d942fdaf1d432b92c92a8c5fcb4751ecf1a491963922e6d9118fa9affd11a571b4a14c8db4a427a66189e4dc4a0bdfae2b3710ab35a247fdd4af4938f9db5587d89b7b4d94a5509687a755411dc54e7b0c622563eda141be8dedf19074881626a7d96cfb67626ebbdde418bbfc86451d2b7d01fa6efc55c13a3b0b21f1df90cedb58820d8612b31496b1309f11ae2cf456bffec0a9eb15eec6268773ebdcc361c892aa9b6330896ff42721fc7fca38a66bb61e5994045361c78f07a9d1bf2857e888d31501548bbc6dd0147c1404078e5fd8f16f6256f9b277035837b1d7c65e1b08d3504b1ab42b1432a040a376f3a4820b99c6c01d1766260891309c4f7f49a03a674f4bde2fe92923ff27641c63ea060b5210c3b15e126b45a98371cfa315ac961b4a941d007cfffb8a86364a962efff7cb851522ce36f05a1882fc1b81daf532ea0b01095af25de80af9b41ed77c6f6936c7cf03528d0814eef2a72499dc78f1b6d1bcf59ff32e7c2b961d6756816a9c11e00953ae256898fd5f950316d39fc2e8a3d420aed3aa5589778b6e3bc035a28941a0ad4ad66d0cf121536a320f6cc1fa19f36d4e15b560e8e2b88ff6e1df960cbc4e77d219ff6f176f838a93143b89c3e69030db4dae84681c43b5ea8ca15504d596d22d36290ef74d0a81f48161695da9fe4627e7d854403b1f0318b2dd980169ba4e0d17d786fd1ae3596a40dca223fd378195ca3e23e778f86a74dd9da5feed19abeda81e5e80144b1f66c9674710565779814c1403bff90c1d67bdb62038119394d56024692fc23f8e9014bbd9d40dabf3ec5e8906a73d2c072b0bf99d26f7b1b5e0e458cae78c42fdccef893a044caae4461c4d985de6c0ba33c427c272cfd419bf74df516000a65c4aae3fd03ebaed1094fd910bc27a2ea924854436729b142b1d84d44824e2a75c90ff52c0c6bbc4c3f7bc10cd98ec9ff8d983d9f0896e463d51e5f1f84fc7da4bbb4bdeaddcf28b3b7b5e73e8084b68888b53c0ce0623a59240b575f362cd089af3b59ec03d4516191cfab6a7e421a29e5b434c43b8abd47a1c6af4a5c86b2541de587f9caa0c71e5516f537c2c31ffed5f2f2af7497145dd2e34e4d5138cc68afc3a2dd6373a1d6caef93c5348a9f05bf15af43e98fe06bd32acd5ca7f41101415d64fd77101d26268c84a801df010ad8d334ab499f0c70cb180d81918cb2f47bfc6b3405d933452215bc16ab4d00f838c58093c26dabe2394ba4f58a31243ae5797b3b70a18db07ac68a0fd91fe57d300b72fc46757ffafac19366929f68719e75960e076f346f48d578f0cf99c596817ba67e76d17fba87aec0b36c26f00114e5404ee26ddc48f04f2569133e7552dde427a3e8cdaa6eb0e23f423f81ef4342555187f9d23d85e5b9f25b918ce9ba3afcc045774929e2917e759f679b765ff32381a05783597711d688a1aedf385ef184e851c5a407fa50f576dc9a43bbbe0d97f45f02df8da9ee0b1f753c123c45e4279fd5f4815f96d6892c0b560f21aae096d3d385f486543e0449516df2d1a08a1eb47bc1c60018984f6d6638ead23b3ae9e3ff0b744bda7d9be379015319dee9b29565c7cf58fef0004ec160e862cca4516088d09153ffaab96daf89d57983d3c53fbd4e984c8009a3f7f80b01c8104ee7ebab26ae89e138efec7830d730396ed2e9f7f8411f84034fe896e5d4d292311917f69c88ac59c31d94db918ea3dced1ead721d5dd653215ae54138d4e7d16c81b305c9d46ba12e27219c82279661d9529c7d95747b316fc02f49c005914882df4fa0405dae9f734551c45f97e695ef2eb87f3fb4eda0ef058b196058eb9bf414cb34160d3b1d768556a567ba816f9873b68ac80adce7ca47d35f96a9e82946d80e2c986fd0209fe7996e71cb7f42d48ba83fc477e00347f14b6ec7a65b7095a0c9fef8887e4d0a126edaa5994dd976b70bf1e67b39c3215562e8a14f6a97f7cea703996d5ba6de23c2dba84c9f6f2827bcee63bd0848c91f2ad913a831f194120ca95e7e8226737c7e32eabb63e30feea212229974c7e844b77ef2b350a2ffb9475e84a74e3ac5f33e10769a093e2c8d88aaecdd2e86f37cb7dfcde60b73a83c6fe9da29ae4c610179b1ecfe825ef8c5baaf4108b8050d187bbdf5bc510b37937948e2d1c1a63527490ec7cf677f1ef777d8efe0e10d2089cba2745a2754f1d950f943f532791cd4e508f6236fa6b7d318baeb05e9435231e66bb61690682b366c7fdc5c556d2a7dcbe773b22daf9204d9019e4f3017bd3c7728129cd180b402d8c98e8d8253eeb953c1972fec08822b7cda3ecbf92ce48b0fd473d8d7314cd4e54bea90cc7070c68315a96f6754c5035a3040a4a76ddbf36f09a0384f7ce101443beaa228774ba35bad02fce3a7a4e1964b05247a045d67d2291cb0ea25dfbe1415393b42810a02332599a23bd5b97b00bef2c7356e540a403fdc36d01bf94af0c1e407bb4a74896fa3f168b29e0790ca9323bbd1d66b153f6eab66e06cd46f05dfbd1987ce53e294b052452e7421f0941348ecd34f308ad201ee001fa7eb6eacb0c8ce3462162bbf61851e342d22b66ffbf36659c36f4f0c19327ab3cde2f27d9185361506e9a4013ac8919afeb1d30cf2adf8410ffe99a40fad3869ff444617e76e2b6bfad42ed5ed01bc1d7ca428b47fd15714c7e79afbbc57564d2a3a426b8341273983bb3e3eca6cb811cc3db1f1b8a6b8b42aeef0047be74ff291d22c2fb6880b1e4f663fed5bd0bb170a091ed962aa91db43bfc3019d9a6e77e76fea9775ca1b9dbec6452628b62b27890f85a9a33f35d83397d9dc1ced6039987bec3ca0e5072d4a5b2ccedeab447676267328ef3fcabe3d5af6a71e9c47eb784acaf104faf26e067752ab228c9831d9ce7e5e28884fa5b27884ffc988475266a03c5e7afcd9301fd56e5f14a7a92f2aa362ea46f3d174766762de80b1027a8cf9364926c8c7f75c3d8992073fa47b3c2dad2c85a7b387db30a002f883e117459a7dbc6840302ef3af8a24aebbcba4f39405ad482e16fe9d0199ef42dad6b5e3fb0d5786ce8364f4de4ff632d942254b24bb268c9c7eae7c958e9baecc1804e49c1d8ea799af7415719eb6ff2a9fd25034f9fa77676c70af9a8e4b5f23f5a43f8750de77d714ef2167a4b956e2df1e77874044788ebc965dd07159e3df09e093c80c0c0ec6f8412196d10ff04473f294c85d6b36cb06e1fdb03bbed2149d213bd455a0f731adfcfd2e0c79f3153386063447a2234182e446f682a6479f234d07c8762871a432b6187d1747e979a4209dc675c14bbce6c4bb58365e17197966a9325d9ce1fef676e357f8f756aa18f5b968280878d560bd198459f264c95ea085911c4f618637d1a7d16a7ee8231d5aa3d7280f4d45a62efb9d02376f1314d743b8f80299824010b774872a811b4963cc8a9d4a2296de184a8eec84932a91a206727c2db7a4ea1761fefe0b7123e02734c625ef8bc5268ef30c7c8ac3f9d8792f286bace205cbf7795be28789a1ccba9ca29145091c2e2625733d1521bc304213efc63a4f8e1b3311f6ea437bac664cd13da3a841e8c05ac8c73ae9bd8a914ea419c34640521af3f7ac284037dd0eb480489f41a7f9c821c242fc234dacef57185ba9bb84ec8b3101c54d34a6901286ad3c19011cebb175269976405e03a04a1cf5a8a5aa94f4c327a6c3a8c82b2c9c35937e7c8362a5f5270a70e2e93e97fa4f501a979a17ab1a3437713e97ed8f09c77177213dd4d0a967b10409944309d12c801e5841975d234b6f1a44016636055bd9e9d8e511acc279dfe9e770652e81b318df06936940d08f5e26dca602a4198c19133ffcac12f3b70a51202de0c650a9eff0d02ee18fdb4588336d8758c0c959cac82e0bc4f03aeda850303b99795f172f014b64a6b09d844f9befe01385d3162fca78ab8119a10344b488e5d37ba5052128554b94c0f161378b6cb2dbdd750aed460843b39998658fee8de87e9ba49e3922f836f3e33f24f94312d498a5a92e37a99c207744006dd8d56d94667a621303855f43dbc286e02f909dcb31af3cc64c4feca5cf558410d467433c208a76f3462b2146be9c30cd570a425b05784d5d0db30bfa9c6896b12b550e985ec23fea8de92b7752acd94afe3755a4433040d9fafccd4c836c251b4c2f07372cc39e562df2384d9c05f7f780f98dd164694c423c4378ed60e0156d3704b3d26a3394268906d791540c24b059aa80acb0dc407c6498f4bde75868219b07241fed94f252762d2b3f1c365588acff562299299d11d87bff8732c9f2d382369d18594c0097a2065f1aa3179f1b23a8ed936e91642dadb1180b501da7cd95e1593fb8041e5dfe60e545c87966c4f873a4ce0385f9fbbe5abaa62343892044cc7559208235e3a57bb4abc941531338bd6893ec44956ab6f487aff8699d4ffe523e053f76b60f1a89e52ab6c5cecc0ac1f18e08c6d34e1be2dfe3a9d6a27456b06f1e16317c37298a4b77ab3311ef7ed276e8f95902a753295d73b971d80f9f5bab825e6139574f4d83b4daef0f34c17ce525f5a6b545df694f74c1f33ba2c8ac53342027e021396a52a81f016c49dc5c8d363eaa1efeea9539e195ad0bf8bd066c14c1f20bf2ca5f6dc78d174952cf2bc5ee631c9f3d5990ad46b8ae01021ca027e326c639c7fd0e96f8aa7c5d2687f980e202f2a07b8dd63732ec0e1b4459abbc6e8e24bdf6b0015ffa9faeafb494b1d092a955f027cfdd7f42eec9b3614b03c8661810ae4717dc70d450c0351e2ed183531d24a6862353bf0cd96f5da96ba4bf3055fb7ae19ad5022c01724b04302eba6448733dfe09f538da0d1557a935c95df4701c7bc0b57927bc23d96a01ccae42a9a88f7a6129fdde8e8dcd7b9caac12cfa4474f0b02a78e04adcea1924a5ba84e9d0a951db58cba8489ca9aa118a50925a752fc7ad1ad7666fd6c25c4d533bd8006cc4b7c71e5398f687aa02f09fb53e6991666e16c7534d45d95fb5df798251d14565a8669756eea2a6bb49837f9bb33f7f38e8306a135464da6b2017a1cf50cba1fa34375bbb0ce8bb78c8853ae14b70abdaa0fa1adc4227971d03cbe9b74efc673695e27e6804fd858edfa8481a0b7d52a230c69585146cd9ddce84ab701e8df25833fb6c2d65e6a1170c38c6046f2ddd7e6a02eba93d2dee9d359076f9752d1be3b1567a9bb179448927e5b012e1de61e7a80940baf0499ef7fa8c8f3df8d864302c05f51e01ba6077bc524ada68a07b1f871676610809b0ce774e79d79c0063e6b70a626cdc975d2d0504a2cb4cf0068405010bff9c0ab7f5598632db5e7a2d341283a7da9eb5c7be9e5d29a5e95622ae45c9e1efd5bac45e7ec248477d5acf42925bb79bf346e7b811e7fc29e433bd0e23cf2237474df0abce622e22c8b5a747f1b1c1a627393bca8670085719fb4fe20b99aea25f334bf36edbcb1f0ba15a1dd22a0aaf9376298508994b4409de66bf9b2b0759ab5f3100984fc99687f358ea170c2bd9a97df431c29698ee3626dc7f8824ac7920208799c63435bf06464edf3fe60b06e085dede8cc79156c637f20a069868383a5e64542038d4c3e18ac642d2a1b6ab30112f4be396da9cd4b6957744c07fa59c08028120c5a1e8fdbc0cfbdbee5cb9241c873665548ae4cf597f812a1b4af6c224298f9f5229081b434b24d16bb96f5a92c884e60698da7f0751bcd5d2c557149e1b4cd08fe9aaf37b283bff47754ef07ff66ef352657b01b9934c24cc2358993d7921d8068cc266a17c85f690b059e8212d5c72898a5a405e4c3e7617097686681253b6e29b1d143eeb3e595ebdeef01ad41ca0e649180eb52cf2d9a56da0619810d4ba0bc5de01309afe93af4e8936958b324eca2b016ab9d714a039dc3f26a4c25993ceee55f90bdb812937c4c2a75fa7aa56f86764412823124fbcfcf4dadbcefaa2e2e6e59c45cf5feffdf3efc604e96f904afc81ce152b5e07458dbbe946d43ad64549a51d6d3bf19e2d1d7ef8db22216f4551b4aea8adcfc7ae1c888f71c297af30a7d0</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">请使用梦之钉</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 记录 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>前言</title>
      <link href="/2000/02/29/%E5%89%8D%E8%A8%80/"/>
      <url>/2000/02/29/%E5%89%8D%E8%A8%80/</url>
      
        <content type="html"><![CDATA[<h1 id="开场白"><a href="#开场白" class="headerlink" title="开场白"></a>开场白</h1><p>终于还是开了个博客</p><p>18-19年期间写过一些东西，发表在了朋友搭的blog上<del>然后朋友沉迷地球OL导致一个月忘了续费，服务器直接升天</del>，体验极差，所幸自己有保留原档。<br>今天整理收藏夹看到了已经失效的博客链接，就干脆开一个自己的，以后想写点什么东西的话方便一些。</p><p>至于要写什么东西，还没有什么头绪，兴致来了就写。生活、工作、娱乐可能都会写一写<del>反正没人看</del>。</p><span id="more"></span><h1 id="小小的规划（艰难完成中）"><a href="#小小的规划（艰难完成中）" class="headerlink" title="小小的规划（艰难完成中）"></a>小小的规划（艰难完成中）</h1><ul><li><strong>网站风格</strong>：<del>目前是next的默认主题，体验就是中规中矩的性冷淡风格，打算改一下。虽然比较喜欢这种风格，但说实话有点烂大街了…字体也准备改一下，思源黑体体验还不错，不会犯错的保守字体</del>。稍微换个肤先啦，字体选Noto Sans SC只是因为有感情基础，效果确实不算很好。</li><li><strong>功能</strong>：还没想好，好像也没什么要加的，本质MD阅读器。加那么多花里胡哨的特效和动画只会影响使用体验。</li><li><strong>其他</strong>：Github Pages速度挺捉急的，字体也是走的Google Fonts，但我实在是懒得同步一份gitee（哪怕是写脚本），自用应该问题不大，摸。</li></ul><h1 id="内容方面"><a href="#内容方面" class="headerlink" title="内容方面"></a>内容方面</h1><p>总不能直接贴学习笔记吧…目前就写了点弱鸡文章，场景都比较简单，假如真的有大佬看到的话请留点情面OTL，毕竟咱也不是网安专业的。也可能会归档一下以前在泥潭发的帖子，发学习博客是不可能发的。发点游戏感谢也可以，推特那个字数限制是真的不适合。</p>]]></content>
      
      
      <categories>
          
          <category> 前言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前言 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
